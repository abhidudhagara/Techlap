!function(){try{var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},e=Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="3d14229b-b89f-481d-a483-87b0c4c9e99a",t._sentryDebugIdIdentifier="sentry-dbid-3d14229b-b89f-481d-a483-87b0c4c9e99a")}catch(t){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1274],{40210:function(){},93839:function(){},21248:function(){},60949:function(t,e,i){"use strict";i.d(e,{$K:function(){return m},BD:function(){return h},C0:function(){return v},GW:function(){return d},Jo:function(){return w},O3:function(){return l},XW:function(){return b},Zj:function(){return u},be:function(){return k},ec:function(){return f},gT:function(){return x},j6:function(){return a},jf:function(){return o},kT:function(){return y},td:function(){return c},uP:function(){return p},wv:function(){return g}});var s=i(38805),r=i(46291);let n=t=>{t&&t.pages&&t.pages.forEach(e=>{e.width=t.width,e.height=t.height})},{useRetrieveProjectQuery:o,useLazyRetrieveProjectQuery:a,useListProjectsQuery:l,useLazyListProjectsQuery:c,useCreateProjectMutation:h,useUpdateProjectMutation:d,useDeleteProjectMutation:f,useLazyListStitchTemplatesQuery:u,useRetrieveStitchTemplateQuery:g,useLazyRetrieveStitchTemplateQuery:p,useCreateStitchTemplateMutation:m,useUpdateStitchTemplateMutation:v,useDeleteStitchTemplateMutation:y,useRetrieveDataContainerQuery:b,useLazyRetrieveDataContainerQuery:_,useListCategoriesQuery:x,useListTagsQuery:w,useCreateTagMutation:k}=r.hi.injectEndpoints({endpoints:t=>({retrieveProject:t.query({query:t=>({url:"/api/v3/stitch/projects/".concat(t,"?relations=canvas&relations=canvas.pages"),method:"GET"}),transformResponse:t=>(n(t.canvas),t),providesTags:(t,e,i)=>[{type:"Projects",id:i}]}),createProject:t.mutation({query:t=>({url:"/api/v3/stitch/projects",method:"POST",body:t}),transformResponse:t=>(n(t.canvas),t),invalidatesTags:["Projects"]}),updateProject:t.mutation({query:t=>{let{id:e,...i}=t;return{url:"/api/v3/stitch/projects/".concat(e),method:"PATCH",body:i}},transformResponse:t=>(n(t.canvas),t),invalidatesTags:["Projects"]}),listProjects:t.query({query:t=>({url:"/api/v3/stitch/projects",method:"GET",params:t}),providesTags:["Projects"]}),deleteProject:t.mutation({query:t=>({url:"/api/v3/stitch/projects/".concat(t),method:"DELETE"}),invalidatesTags:["Projects"]}),listStitchTemplates:t.query({query:t=>({url:"/api/v3/stitch/templates",method:"GET",params:t}),transformResponse:t=>(t.data.map(t=>{n(t.canvas)}),t),providesTags:["Templates"]}),retrieveStitchTemplate:t.query({query:t=>({url:"/api/v3/stitch/templates/".concat(t,"?relations=canvas&relations=canvas.pages"),method:"GET"}),transformResponse:t=>(n(t.canvas),t),providesTags:(t,e,i)=>[{type:"Templates",id:i}]}),createStitchTemplate:t.mutation({query:t=>({url:"/api/v3/stitch/templates",method:"POST",body:t}),transformResponse:t=>(n(t.canvas),t),invalidatesTags:["Templates"]}),updateStitchTemplate:t.mutation({query:t=>{let{id:e,...i}=t;return{url:"/api/v3/stitch/templates/".concat(e),method:"PATCH",body:i}},transformResponse:t=>(n(t.canvas),t),invalidatesTags:(t,e,i)=>{let{id:r}=i;return[{type:"Templates"},{type:"Templates",id:r},{type:"Templates",id:s.j}]}}),deleteStitchTemplate:t.mutation({query:t=>({url:"/api/v3/stitch/templates/".concat(t),method:"DELETE"}),invalidatesTags:["Templates"]}),retrieveDataContainer:t.query({query:t=>({url:"/api/v3/stitch/projects/data-container?logo_package=".concat(t),method:"GET"})}),listCategories:t.query({query:t=>({url:"/api/v3/stitch/categories",method:"GET",params:t})}),listTags:t.query({query:t=>({url:"/api/v3/tags",method:"GET",params:t}),providesTags:["Tags"]}),createTag:t.mutation({query:t=>({url:"/api/v3/tags",method:"POST",body:t}),invalidatesTags:["Tags"]})})})},53587:function(t,e,i){"use strict";i.d(e,{U:function(){return s}});let s={id:"47ab2b96-1b47-4a3b-8aba-de07962c904a",family:"Open Sans",italic:!1,weight:400,url:"https://app-cdn.logo.com/assets/fonts/47ab2b96-1b47-4a3b-8aba-de07962c904a.ttf"}},95035:function(t,e,i){"use strict";i.d(e,{X:function(){return n},f:function(){return o}});var s=i(7344),r=i(51967);let n="constrainedTextbox",o=s.fabric.util.createClass(s.fabric.Textbox,{type:n,area:null,textAlign:"left",verticalTextAlign:"top",maxOverrideTextLines:0,textBaseline:"bottom",fontSize:20,top:0,left:0,maxLines:5,evented:!1,selectable:!1,controls:!1,_splitTextIntoLines:function(t){let e=t.split("\n");return{lines:e,graphemeLines:e.map(t=>t.split("")),_unwrappedLines:e.map(t=>t.split("")),graphemeText:t.split("")}},recalcTextPosition:function(){this.canvas.renderAll();let t=this.area.left*this.area.scaleX,e=this.area.top*this.area.scaleY,i=this.area.width*this.area.scaleX,r=this.area.height*this.area.scaleY,n=this.fontSize,o=this.__lineWidths.reduce((t,e)=>Math.max(t,e),0),a=this.height;o>i||a>r?n=Math.min(i/o*n,r/a*n):(o<i||a<r)&&(n=Math.min(i/o*n,r/a*n)),n=Math.floor(n),this.set({fontSize:Math.max(n,1)}),this.width=this.area.width,this.dirty=!0,this.setCoords(),this.canvas.renderAll();let l=0,c="left",h="top";switch(this.textAlign){case"left":l=t,c="left";break;case"center":l=t+i/2,c="center";break;case"right":l=t+i,c="right"}let d=0;switch(this.verticalTextAlign){case"top":d=e,h="top";break;case"center":d=e+r/2,h="center";break;case"bottom":d=e+r,h="bottom"}let f=this.angle;if(0!==f){let i=s.fabric.util.degreesToRadians(f),r=Math.cos(i),n=Math.sin(i),o=l-t,a=d-e;l=o*r-a*n+t,d=o*n+a*r+e}this.setPositionByOrigin(new s.fabric.Point(l,d),c,h),this.width=this.area.width,this.dirty=!0,this.setCoords(),this.canvas.renderAll()},initialize:function(t,e){this.callSuper("initialize",t,e),this.textAlign=e.textAlign||"left",this.verticalTextAlign=e.verticalTextAlign||"top",this.setCoords(),this.initialized=!0,this.area=new s.fabric.Rect({fill:"transparent",left:e.areaLeft||0,top:e.areaTop||0,width:e.areaWidth||100,height:e.areaHeight||100,angle:e.angle||0,linkedElement:this,internal:!0}),this.on("added",()=>{var t;this.setCoords(),this.canvas.add(this.area),this.area.top=e.areaTop||this.top,this.area.left=e.areaLeft||this.left,this.area.width=e.areaWidth||this.width||300,this.area.height=e.areaHeight||this.height||100,this.area.angle=this.angle,this.area.setCoords(),this.maxOverrideTextLines=null!==(t=e.maxOverrideTextLines)&&void 0!==t?t:0,this.area.on("moving",()=>{this.recalcTextPosition()}),this.area.on("modified",()=>{this.recalcTextPosition()}),this.area.on("rotating",()=>{this._prevAngle=this.angle,this.angle=this.area.angle,this.recalcTextPosition()}),this.area.on("scaling",t=>{this.recalcTextPosition()}),this.area.on("mousedblclick",t=>{let{e}=t;this.selectable=!0,this.evented=!0,this.canvas.setActiveObject(this),this.enterEditing(),this.area.selectable=!1,this.setCursorByClick(e)}),this.area.on("removed",()=>{this.canvas.remove(this)}),this.recalcTextPosition()}),this.on("modified",()=>{this.recalcTextPosition()}),this.on("removed",()=>{this.canvas.remove(this.area)}),this.on("editing:entered",()=>{this.area.stroke="#000000",this.area.selectable=!1}),this.on("editing:exited",()=>{this.selectable=!1,this.evented=!1,this.area.selectable=!0,this.area.stroke="transparent"}),this.on("changed",()=>{this.recalcTextPosition(!0)}),this.on("removed",()=>{this.canvas.remove(this.area)})},resetAreaToText:function(){this.area.set({left:this.left,top:this.top,width:this.width,height:this.height}),this.area.setCoords()},splitTextIntoMaxOverrideLines:function(){if(this.maxOverrideTextLines<=1)return;let t=this.text.split(" ").map(t=>t.split("\n")).flat().map(t=>t.trim()).filter(t=>!!t),e=[],i="",s=this.maxOverrideTextLines,r=Math.ceil(this.text.length/s);for(let n=0;n<t.length;n++){let o=t[n],a=i?i+" "+o:o;a.length>r&&i.length>0&&e.length<s-1?(e.push(i),i=o):i=a}e.push(i),this.text=e.join("\n"),this.recalcTextPosition()},toObject:function(t){return s.fabric.util.object.extend(this.callSuper("toObject",t),{areaLeft:this.area.left,areaTop:this.area.top,areaWidth:this.area.width,areaHeight:this.area.height})}});o.fromObject=function(t,e){let{areaLeft:i,areaTop:s,areaWidth:n,areaHeight:o,hasControls:a,maxOverrideTextLines:l,originY:c,overrides:h,overridesApplied:d,verticalTextAlign:f,angle:u,...g}=t,p=-n/2,m=-o/2,v=(0,r.gM)({textboxOptions:{...g,left:p,top:m,width:n},areaOptions:{left:p,top:m,width:n,height:o},groupOptions:{maxOverrideTextLines:l,verticalTextAlign:f,hasControls:a,overridesApplied:d,overrides:h,top:s,left:i,width:n,height:o,originY:c,angle:u}});return v.recalcTextPosition(),e(v),v}},51967:function(t,e,i){"use strict";i.d(e,{Dp:function(){return a},RD:function(){return c},bV:function(){return l},gM:function(){return g},j7:function(){return h}});var s=i(81052),r=i(7344),n=i(47113),o=i(95035);let a="#000000",l="click to edit",c="groupedConstrainedTextbox",h=r.fabric.util.createClass(r.fabric.Group,{initialize:function(t,e){let i=t.find(t=>"textbox"===t.type||t.type===o.X);if(!i){console.error("No textbox found during GroupedConstrainedTextbox initialization");let t=d();i=new r.fabric.Textbox(t.text,t)}this.textbox=i,this.textbox._originalSplitTextIntoLines=this.textbox._splitTextIntoLines,this.textbox._splitTextIntoLines=this._splitTextIntoLines,this.textbox.recalcTextPosition=this.recalcTextPosition.bind(this);let s=t.find(t=>"rect"===t.type||"groupedConstrainedTextboxArea"===t.type);if(!s){console.error("No rectangle found during GroupedConstrainedTextbox initialization.");let t=f();s=new r.fabric.Rect(t)}this.area=s;let n=u(e);this.verticalTextAlign=n.verticalTextAlign,this.maxOverrideTextLines=n.maxOverrideTextLines,this.overridesApplied=n.overridesApplied,this.callSuper("initialize",[this.textbox,this.area],{...e}),this.setCoords(),this.initializeEvents(),this.initialized=!0},initializeEvents:function(){this.on("added",this.handleAdded),this.on("scaling",this.handleGroupScaling),this.on("mousedblclick",this.handleMouseDblClick)},handleGroupScaling:function(){this.recalcTextPosition()},handleAdded:function(){this.textbox._splitTextIntoLines=this._splitTextIntoLines,this.recalcTextPosition()},handleMouseDblClick:function(t){let{e}=t;if((0,n.cO)(this))return;let i=this.createEditingTextbox(this.textbox);i._splitTextIntoLines=this._splitTextIntoLines,this.textbox.visible=!1,this.canvas.add(i),this.canvas.setActiveObject(i),i.setCursorByClick(e),i.enterEditing(),i.on("editing:exited",()=>{let t=i.text,e=this.textbox.text;i.visible=!1,this.canvas.remove(i),this.textbox.visible=!0,t!==e&&(t=(0,n.A1)(i),this.textbox.set({text:t,visible:!0}),this.recalcTextPosition(),this.canvas.fire("text:changed",{target:this})),this.canvas.setActiveObject(this)})},_splitTextIntoLines:function(t){let e=t.split("\n");return{lines:e,graphemeLines:e.map(t=>t.split("")),_unwrappedLines:e.map(t=>t.split("")),graphemeText:t.split("")}},createEditingTextbox:function(t){return new r.fabric.Textbox(t.text||"",{...t.toObject(["textCase"]),top:this.top,left:this.left,angle:this.angle,visible:!0,hasControls:!1,lockMovementX:!0,lockMovementY:!0,lockScalingX:!0,lockScalingY:!0,lockRotation:!0,lockUniScaling:!0})},recalcTextPosition:function(){let t=this.width,e=this.height,i=t*this.scaleX,s=e*this.scaleY;this.set({width:i,height:s,scaleX:1,scaleY:1});let n=-this.width/2,o=-this.height/2;this.area.set({width:i,height:s,left:n,top:o,scaleX:1,scaleY:1});let a=this.textbox.height,l=this.textbox.calcTextWidth(),c=this.textbox.fontSize,h=i/l*c,d=c;d=Math.max(d=Math.floor(d=Math.min(h,s/a*c)),1),this.textbox.set({fontSize:d,width:i,fixedWidth:i,scaleX:1,scaleY:1});let f=0,u="left";switch(this.textbox.textAlign){case"left":f=n,u="left";break;case"center":f=n+i/2,u="center";break;case"right":f=n+i,u="right"}let g=0,p="top";switch(this.verticalTextAlign){case"top":g=o,p="top";break;case"center":g=o+s/2,p="center";break;case"bottom":g=o+s,p="bottom"}this.textbox.setPositionByOrigin(new r.fabric.Point(f,g),u,p)},splitTextIntoMaxOverrideLines:function(){if(this.maxOverrideTextLines<=1)return;let t=this.textbox.text||"",e=t.split(" ").flatMap(t=>t.split("\n")).map(t=>t.trim()).filter(t=>!!t),i=[],s="",r=this.maxOverrideTextLines,n=Math.ceil(t.length/r);for(let t=0;t<e.length;t++){let o=e[t],a=s?"".concat(s," ").concat(o):o;a.length>n&&s.length>0&&i.length<r-1?(i.push(s),s=o):s=a}i.push(s),this.textbox.text=i.join("\n"),this.recalcTextPosition()},resetAreaToText:function(){let t=this.textbox.calcTextWidth(),e=this.textbox.height,i=r.fabric.util.transformPoint(this.textbox.getPointByOrigin(this.textbox.textAlign||"left","top"),this.textbox.calcTransformMatrix());this.set({height:e,width:t,left:i.x,top:i.y}),this.recalcTextPosition(),this.canvas.requestRenderAll()},toObject:function(t){return r.fabric.util.object.extend(this.callSuper("toObject",t),{})}}),d=t=>{var e,i,r,n,o,c,h,d;return{...t,fill:null!==(e=null==t?void 0:t.fill)&&void 0!==e?e:a,fontSize:null!==(i=null==t?void 0:t.fontSize)&&void 0!==i?i:20,fontFamily:null!==(r=null==t?void 0:t.fontFamily)&&void 0!==r?r:"Arial",strokeWidth:null!==(n=null==t?void 0:t.strokeWidth)&&void 0!==n?n:0,height:null!==(o=null==t?void 0:t.height)&&void 0!==o?o:50,width:null!==(c=null==t?void 0:t.width)&&void 0!==c?c:150,textAlign:null!==(h=null==t?void 0:t.textAlign)&&void 0!==h?h:"left",text:null!==(d=null==t?void 0:t.text)&&void 0!==d?d:l,type:"textbox",backgroundColor:void 0,id:(0,s.V)("grouped-constrained-textbox-text")}},f=t=>{var e,i,r,n,o;return{...t,fill:null!==(e=null==t?void 0:t.fill)&&void 0!==e?e:"transparent",width:null!==(i=null==t?void 0:t.width)&&void 0!==i?i:150,height:null!==(r=null==t?void 0:t.height)&&void 0!==r?r:50,top:null!==(n=null==t?void 0:t.top)&&void 0!==n?n:0,left:null!==(o=null==t?void 0:t.left)&&void 0!==o?o:0,selectable:!1,type:"rect",stroke:void 0,id:(0,s.V)("grouped-constrained-textbox-area")}},u=t=>{var e,i,r,n,o,a,l;return{...t,top:null!==(e=null==t?void 0:t.top)&&void 0!==e?e:0,left:null!==(i=null==t?void 0:t.left)&&void 0!==i?i:0,angle:null!==(r=null==t?void 0:t.angle)&&void 0!==r?r:0,maxOverrideTextLines:null!==(n=null==t?void 0:t.maxOverrideTextLines)&&void 0!==n?n:0,verticalTextAlign:null!==(o=null==t?void 0:t.verticalTextAlign)&&void 0!==o?o:"top",overridesApplied:null!==(a=null==t?void 0:t.overridesApplied)&&void 0!==a&&a,overrides:null!==(l=null==t?void 0:t.overrides)&&void 0!==l?l:{},type:c,id:(0,s.V)("grouped-constrained-textbox-group")}};function g(t){let{textboxOptions:e,areaOptions:i,groupOptions:s}=t,n=d(e),o=new r.fabric.Textbox(n.text,n),a=f(i);return new h([o,new r.fabric.Rect(a)],u(s))}h.fromObject=function(t,e){let i=null==t?void 0:t.objects.find(t=>"textbox"===t.type),s=null==t?void 0:t.objects.find(t=>"rect"===t.type||"groupedConstrainedTextboxArea"===t.type),{objects:r,...n}=t,o=g({textboxOptions:i,areaOptions:s,groupOptions:n});return e(o),o}},76948:function(t,e,i){"use strict";i.d(e,{C:function(){return d}});var s=i(81052),r=i(7344),n=i(29653);function o(t,e){let i=4*e.strokeWidth;t.beginPath(),t.moveTo(-i,i),t.lineTo(0,0),t.closePath(),t.strokeStyle=e.stroke,t.lineJoin="round",t.stroke(),t.beginPath(),t.moveTo(-i,-i),t.lineTo(0,0),t.closePath(),t.strokeStyle=e.stroke,t.lineJoin="round",t.stroke()}function a(t,e){let i=2*e.strokeWidth;t.beginPath(),t.moveTo(-i,i),t.lineTo(0,0),t.closePath(),t.strokeStyle=e.stroke,t.lineJoin="round",t.stroke(),t.beginPath(),t.moveTo(-i,-i),t.lineTo(0,0),t.closePath(),t.strokeStyle=e.stroke,t.lineJoin="round",t.stroke()}function l(t,e){let i=2*e.strokeWidth;t.beginPath(),t.moveTo(0,i),t.lineTo(0,-i),t.closePath(),t.strokeStyle=e.stroke,t.lineJoin="round",t.stroke()}function c(t,e){let i=e.strokeWidth;t.beginPath(),t.arc(0,0,i,0,2*Math.PI),t.closePath(),t.strokeStyle=e.stroke,t.fillStyle=e.stroke,t.stroke(),t.fill()}function h(t,e,i,s){let r;if(!i)return;let h=null;switch(h=e===n.AR.Start?{x1:s.x1,y1:s.y1,x2:s.x2,y2:s.y2}:{x1:s.x2,y1:s.y2,x2:s.x1,y2:s.y1},i){case n.G_.Arrow:r=o;break;case n.G_.ArrowSmall:r=a;break;case n.G_.Bar:r=l;break;case n.G_.Circle:r=c;break;default:return}if(r){t.save();let e=h.x1-h.x2,i=h.y1-h.y2;t.translate((h.x1-h.x2)/2,(h.y1-h.y2)/2),t.rotate(Math.atan2(i,e)),r(t,s),t.restore()}}let d=r.fabric.util.createClass(r.fabric.Line,{type:"advancedLine",id:(0,s.V)("advancedLine"),hasControls:!1,strokeWidth:5,fill:"#000000",stroke:"#000000",startLineType:null,endLineType:null,padding:30,targetFindTolerance:30,initialize(t){this.callSuper("initialize",t)},toObject(){return r.fabric.util.object.extend(this.callSuper("toObject"),{type:this.type,id:this.id,lockScalingX:this.lockScalingX,lockScalingY:this.lockScalingY,fill:this.fill,stroke:this.stroke,startLineType:this.startLineType,endLineType:this.endLineType,stokeWidth:this.strokeWidth,strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:this.strokeMiterLimit,strokeUniform:this.strokeUniform,x1:this.x1,y1:this.y1,x2:this.x2,y2:this.y2,top:this.top,left:this.left})},_render(t){this.callSuper("_render",t),this.visible&&(h(t,n.AR.Start,this.startLineType,this),h(t,n.AR.End,this.endLineType,this))}});d.prototype.controls={}},6631:function(t,e,i){"use strict";i.d(e,{v2:function(){return r.v2},RD:function(){return r.RD},KP:function(){return r.KP},G_:function(){return r.G_},a3:function(){return r.a3},yf:function(){return W},$W:function(){return K},ml:function(){return o.ml},fh:function(){return o.fh},w0:function(){return o.w0},ie:function(){return o.ie},gK:function(){return o.gK},$r:function(){return o.$r},zY:function(){return o.zY},cO:function(){return o.cO},ty:function(){return o.ty},Or:function(){return o.Or},P7:function(){return o.P7},VV:function(){return o.VV},Gs:function(){return o.Gs}});var s=i(90690),r=i(29653),n=i(7344),o=i(47113),a=i(81052),l=i(23137),c=i(76948);let h={shiftSnapAngle:45,ctrlSnapAngle:15,defaultElementColor:"#9FA6B2"};class d{setControlCoordinates(){if(!this._selectedLine)return;let t=this._selectedLine.x1,e=this._selectedLine.y1,i=this._selectedLine.x2,s=this._selectedLine.y2,r=this._selectedLine.left-Math.min(t,i),n=this._selectedLine.top-Math.min(e,s);t+=r,e+=n,i+=r,s+=n;let o=8/this._canvas.viewportTransform[0];this._startControl.set({left:t+this._selectedLine.strokeWidth/2,top:e+this._selectedLine.strokeWidth/2,radius:o}).setCoords(),this._endControl.set({left:i+this._selectedLine.strokeWidth/2,top:s+this._selectedLine.strokeWidth/2,radius:o}).setCoords(),this._startControl.bringToFront(),this._endControl.bringToFront()}createControl(t){let e=new n.fabric.Circle({left:0,top:0,radius:8,fill:"#1890ff",originX:"center",originY:"center",hasControls:!1,hasBorders:!1,lockScalingX:!0,lockScalingY:!0,lockRotation:!0});return e.controls={},e.set({id:t}),e}hideControls(){this.linesAreShown&&(this._canvas.remove(this._startControl),this._canvas.remove(this._endControl),this.linesAreShown=!1)}showControls(){this.linesAreShown||(this._canvas.add(this._startControl),this._canvas.add(this._endControl),this._startControl.set({id:"lm-start"}),this._endControl.set({id:"lm-end"}),this._startControl.set({visible:!0}),this._startControl.setCoords(),this._endControl.set({visible:!0}),this._endControl.setCoords(),this.setControlCoordinates(),this.linesAreShown=!0)}constructor(t){this._canvas=t,this._selectedLine=null,this.linesAreShown=!1;let e=this.createControl("lm-start"),i=this.createControl("lm-end");this._startControl=e,this._endControl=i,t.on("selection:cleared",()=>{this._canvas.remove(this._startControl),this._canvas.remove(this._endControl),this._selectedLine=null}),t.on("mousewheel",()=>{this.setControlCoordinates()}),t.on("object:moving",t=>{var e;let{target:i,e:s}=t;if(!i||!this._selectedLine){this.hideControls();return}if(this._selectedLine.setCoords(),null===(e=i.id)||void 0===e?void 0:e.startsWith("lm")){if(s.shiftKey||s.ctrlKey){let t=s.shiftKey?h.shiftSnapAngle:h.ctrlSnapAngle,e=(0,o.Ht)(t),r="lm-start"===i.id?this._endControl:this._startControl,n=i.left-r.left,a=i.top-r.top,l=Math.round(Math.atan2(a,n)/e)*e,c=Math.sqrt(n*n+a*a);i.left=r.left+c*Math.cos(l),i.top=r.top+c*Math.sin(l),i.setCoords()}this._selectedLine.set({x1:this._startControl.left-this._selectedLine.strokeWidth/2,y1:this._startControl.top-this._selectedLine.strokeWidth/2,x2:this._endControl.left-this._selectedLine.strokeWidth/2,y2:this._endControl.top-this._selectedLine.strokeWidth/2,scaleX:1,scaleY:1})}else if(i.id===this._selectedLine.id){this.hideControls();let t=i.x1,e=i.y1,s=i.x2,r=i.y2,n=i.left-Math.min(t,s),o=i.top-Math.min(e,r);t+=n,e+=o,s+=n,r+=o,i.set({x1:t,x2:s,y1:e,y2:r,top:i.top,left:i.left,scaleX:1,scaleY:1}),i.setCoords()}else this.hideControls();this._endControl.setCoords()}),t.on("object:modified",t=>{let{target:e}=t;e&&(this._selectedLine&&e.id===this._selectedLine.id&&this.showControls(),e&&this._selectedLine&&(this._selectedLine===e||e.id.startsWith("lm"))&&(this._canvas.setActiveObject(this._selectedLine),this.showControls()))}),t.on("selection:updated",t=>{let{selected:e=[],target:i}=t,s=e[0];s?e.length>1?(this.hideControls(),this._selectedLine=null):s.id.startsWith("lm")?this.setControlCoordinates():this._selectedLine||"advancedLine"!==s.type?"advancedLine"===s.type?(this._selectedLine=s,this.showControls()):(this.hideControls(),this._selectedLine=null):(this._selectedLine=s,this.showControls()):(this.hideControls(),this._selectedLine=null)}),t.on("selection:created",t=>{let{selected:e}=t,i=e[0];i?e.length>1?(this.hideControls(),this._selectedLine=null):"advancedLine"===i.type?(this._selectedLine=i,this.showControls(),this.setControlCoordinates()):(this.hideControls(),this._selectedLine=null):(this.hideControls(),this._selectedLine=null),this._canvas.requestRenderAll()}),t.on("mouse:wheel",()=>{this.setControlCoordinates()})}}var f=i(14127);let u=t=>{let{stitch:e,canvas:i}=t,r=t=>{let{target:e}=t;return(0,s.Op)(e)};return(0,o.sQ)(i,{"object:moving":r,"mouse:over":t=>{let{target:e}=t;return(0,s.W2)(e)},"mouse:out":r,"mouse:wheel":r})},g=t=>{let e=t.getCenterPoint(),i=e.x,s=e.y,r=t.getBoundingRect(!0),n=r.height,o=r.width;return{width:o,height:n,left:i-o/2,right:i+o/2,top:s-n/2,bottom:s+n/2,centerY:s,centerX:i}},p=(t,e)=>t-10<e&&e<t+10,m=t=>{let e=t.canvas.frame;if(!e)return;let i=g(t),s={top:i.top,right:i.right,bottom:i.bottom,left:i.left},r={top:e.top,right:e.left+e.width,bottom:e.top+e.height,left:e.left},o=i.centerX,a=i.centerY;p(s.top,r.top)&&(a=r.top+i.height/2),p(s.bottom,r.bottom)&&(a=r.bottom-i.height/2),p(s.left,r.left)&&(o=r.left+i.width/2),p(s.right,r.right)&&(o=r.right-i.width/2),t.setPositionByOrigin(new n.fabric.Point(o,a),"center","center")},v=t=>{if(!t.canvas.frame)return;let e=g(t),i=t.canvas.frame,s=i.top+i.height/2,r=i.left+i.width/2,o=p(e.centerY,s),a=p(e.centerX,r),l=e.centerX,c=e.centerY;return o&&(c=s),a&&(l=r),t.setPositionByOrigin(new n.fabric.Point(l,c),"center","center"),{...e,isVerticallyCentered:o,isHorizontallyCentered:a}},y=t=>{let e=t.frame;return _(t,{x1:e.left+e.width/2+.5,y1:e.top,x2:e.left+e.width/2+.5,y2:e.top+e.height})},b=t=>{let e=t.frame;return _(t,{x1:e.left,y1:e.top+e.height/2+.5,x2:e.left+e.width,y2:e.top+e.height/2+.5})},_=(t,e)=>{let i=n.fabric.util.transformPoint(new n.fabric.Point(e.x1,e.y1),t.viewportTransform),s=n.fabric.util.transformPoint(new n.fabric.Point(e.x2,e.y2),t.viewportTransform),r=t.getSelectionContext();r.save(),r.lineWidth=2,r.strokeStyle="pink",r.beginPath(),r.moveTo(i.x,i.y),r.lineTo(s.x,s.y),r.stroke(),r.restore()},x=t=>{let e=t.canvas,i=g(t),s=(0,o.$3)(e.getObjects()),r=[];for(let e of s){var a;if(e===t||e.linkedElement===t)continue;if(t.linkedElement===e)continue;if((null===(a=t.id)||void 0===a?void 0:a.startsWith("lm-"))&&"advancedLine"===e.type)continue;let s=g(e),o=s.centerY<i.centerY,l=s.centerX<i.centerX,c=p(s.centerX,i.centerX)||p(s.left,i.left)||p(s.left,i.right)||p(s.right,i.left)||p(s.right,i.right),h=p(s.centerY,i.centerY)||p(s.top,i.top)||p(s.top,i.bottom)||p(s.bottom,i.top)||p(s.bottom,i.bottom);if(!c&&!h)continue;let d=i.centerX,f=i.centerY,u=d,m=f;if(c){p(s.centerX,i.centerX)?u=d=s.centerX:p(s.left,i.left)?u=(d=s.left)+i.width/2:p(s.left,i.right)?u=(d=s.left)-i.width/2:p(s.right,i.left)?u=(d=s.right)+i.width/2:p(s.right,i.right)&&(u=(d=s.right)-i.width/2);let t=o?s.top-10:s.bottom+10,e=o?i.bottom+10:i.top-10;r.push({x1:d,y1:t,x2:d,y2:e})}if(h){p(s.centerY,i.centerY)?m=f=s.centerY:p(s.top,i.top)?m=(f=s.top)+i.height/2:p(s.top,i.bottom)?m=(f=s.top)-i.height/2:p(s.bottom,i.top)?m=(f=s.bottom)+i.height/2:p(s.bottom,i.bottom)&&(m=(f=s.bottom)-i.height/2);let t=l?s.left-10:s.right+10,e=l?i.right+10:i.left-10;r.push({x1:t,y1:f,x2:e,y2:f})}t.setPositionByOrigin(new n.fabric.Point(u,m),"center","center")}return{snapLines:r}},w=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.width||e.height||50,s=e.height||e.width||50,r=g(t),o={top:Math.round(r.top/s)*s,left:Math.round(r.left/i)*i,bottom:Math.round(r.bottom/s)*s,right:Math.round(r.right/i)*i},a={top:Math.abs(o.top-r.top),left:Math.abs(o.left-r.left),bottom:Math.abs(o.bottom-r.bottom),right:Math.abs(o.right-r.right)},l=r.centerX,c=r.centerY;a.top<a.bottom&&a.top<10?c=o.top+r.height/2:a.bottom<10&&(c=o.bottom-r.height/2),a.left<a.right&&a.left<10?l=o.left+r.width/2:a.right<10&&(l=o.right-r.width/2),t.setPositionByOrigin(new n.fabric.Point(l,c),"center","center")},k=t=>{let{stitch:e,canvas:i}=t,s=!1,r=!1,n=[],a=()=>{n=[]};return(0,o.sQ)(i,{"object:moving":t=>{var o;let{target:a}=t;if(a&&(null===(o=a.id)||void 0===o||!o.startsWith("lm"))&&"advancedLine"!==a.type){if(e.guideOptions.snapToGrid&&e.guideOptions.show&&w(a,e.guideOptions.gridSize),e.guideOptions.snapToObjects&&(n=x(a).snapLines),e.guideOptions.snapToEdges&&m(a),e.guideOptions.snapToCenter){let t=v(a);s=(null==t?void 0:t.isVerticallyCentered)||!1,r=(null==t?void 0:t.isHorizontallyCentered)||!1}a.setCoords(),i.requestRenderAll()}},"before:render":()=>{let t=i.contextTop;t&&!i.isClipping&&i.clearContext(t)},"after:render":()=>{e.guideOptions.snapToObjects&&n.forEach(t=>{_(i,t)}),e.guideOptions.snapToCenter&&(s&&b(i),r&&y(i)),i.calcOffset()},"mouse:down":a,"mouse:up":()=>{r=!1,s=!1,a(),i.requestRenderAll()}})},T=t=>{let{stitch:e,canvas:i}=t,r={x:0,y:0};return(0,o.sQ)(i,{"mouse:wheel":t=>{let{e:i}=t,r=(0,s.uj)(e.zoom,i.deltaY);i.preventDefault(),i.stopPropagation(),e.zoom=r},"mouse:down":t=>{let{e:s}=t,n=i.getActiveObject();n||s.shiftKey?(!n||"frame"===n.id)&&s.shiftKey&&(i.setCursor("grabbing"),i.isDragging=!0,i.selection=!1):(i.isDragging=!0,i.selection=!0,i.setCursor("default"));let o=i.getPointer(s);r.x=o.x,r.y=o.y,i.lastPosX=s.clientX,i.lastPosY=s.clientY,e.render()},"mouse:up":()=>{if(i.isDragging){let t=i.viewportTransform;i.setViewportTransform(t),i.isDragging=!1,i.selection=!0,i.setCursor("default"),e.render()}},"mouse:move":t=>{let{e:o}=t;if(i.isDragging&&!1===i.selection){let t=i.viewportTransform;t[4]+=o.clientX-i.lastPosX,t[5]+=o.clientY-i.lastPosY,i.setViewportTransform(t),e.render()}else if(i.isDragging){let t=i.getPointer(o),a=Math.abs(t.x-r.x),l=Math.abs(t.y-r.y),c=t.y>r.y?r.y:t.y,h=t.x>r.x?r.x:t.x,d=e.getElements(),f=new n.fabric.Point(h,c),u=new n.fabric.Point(h+a,c+l);d.forEach(t=>{(t.isContainedWithinRect(f,u,!0)||t.intersectsWithRect(f,u,!0))&&(0,s.W2)(t)})}i.lastPosX=o.clientX,i.lastPosY=o.clientY}})},C=t=>{let{canvas:e,stitch:i}=t;return(0,o.sQ)(e,{"after:render":()=>{let t=i.frame;if(!t)return;let r=i.renderOutsideFrame?.5:1,n=e.getContext(),a=e.viewportTransform;n.save();let l=a[4],c=a[5],h=t.width*a[0],d=t.height*a[3];n.beginPath(),n.moveTo(0,0),n.lineTo(e.width,0),n.lineTo(e.width,e.height),n.lineTo(0,e.height),n.lineTo(0,0),n.moveTo(l,c),n.lineTo(l+h,c),n.lineTo(l+h,c+d),n.lineTo(l,c+d),n.lineTo(l,c),n.fillStyle="rgba(255, 255, 255, ".concat(r,")"),n.lineWidth=1,n.fill("evenodd"),n.beginPath(),n.moveTo(l,c),n.lineTo(l+h,c),n.lineTo(l+h,c+d),n.lineTo(l,c+d),n.lineTo(l,c),n.closePath(),n.strokeStyle="rgba(0, 0, 0, 0.2)",n.lineWidth=2,n.stroke(),n.restore();let f=e.getActiveObject();!f||(0,o.P7)(f)||((0,s.W2)(f),(0,o.zY)(f)||f.drawControls(n))}})},S=[{id:"pan",description:"Pan the viewport.",onTrigger:()=>null,keybindings:[{keys:[],shiftKey:!0,ctrlKey:!1,altKey:!1,metaKey:!1,display:"Drag while holding shift"}]},{id:"delete",description:"Delete the currently selected object.",onTrigger:t=>t.deleteSelection(),keybindings:[{keys:["backspace"],shiftKey:!1,ctrlKey:!1,altKey:!1,metaKey:!1,display:"Backspace"},{keys:["delete"],shiftKey:!1,ctrlKey:!1,altKey:!1,metaKey:!1,display:"Delete"}]},{id:"save",description:"Save your design.",onTrigger:t=>t.save(),keybindings:[{keys:["s"],shiftKey:!1,ctrlKey:!0,altKey:!1,metaKey:!1,display:"Ctrl + S",os:"windows"},{keys:["s"],shiftKey:!1,ctrlKey:!1,altKey:!1,metaKey:!0,display:"⌘ + S",os:"mac"}]},{id:"cut-to-clipboard",description:"Cut the currently selected elements to the clipboard.",onTrigger:t=>t.cutSelectionToClipboard(),keybindings:[{keys:["x"],shiftKey:!1,ctrlKey:!0,altKey:!1,metaKey:!1,display:"Ctrl + X",os:"windows"},{keys:["x"],shiftKey:!1,ctrlKey:!1,altKey:!1,metaKey:!0,display:"⌘ + X",os:"mac"}]},{id:"copy-to-clipboard",description:"Copy the currently selected elements to the clipboard.",onTrigger:t=>t.copySelectionToClipboard(),keybindings:[{keys:["c"],shiftKey:!1,ctrlKey:!0,altKey:!1,metaKey:!1,display:"Ctrl + C",os:"windows"},{keys:["c"],shiftKey:!1,ctrlKey:!1,altKey:!1,metaKey:!0,display:"⌘ + C",os:"mac"}]},{id:"paste-from-clipboard",description:"Paste the contents of the clipboard.",onTrigger:t=>t.pasteSelectionFromClipboard(),keybindings:[{keys:["v"],shiftKey:!1,ctrlKey:!0,altKey:!1,metaKey:!1,display:"Ctrl + V",os:"windows"},{keys:["v"],shiftKey:!1,ctrlKey:!1,altKey:!1,metaKey:!0,display:"⌘ + V",os:"mac"}]},{id:"duplicate",description:"Duplicate the currently selected elements.",onTrigger:t=>t.duplicateSelection(),keybindings:[{keys:["d"],shiftKey:!1,ctrlKey:!0,altKey:!1,metaKey:!1,display:"Ctrl + D",os:"windows"},{os:"mac",keys:["d"],shiftKey:!1,ctrlKey:!1,altKey:!1,metaKey:!0,display:"⌘ + D"}]},{id:"toggle-group",description:"Toggle the grouping of the currently selected elements.",onTrigger:t=>t.toggleSelectionGrouping(),keybindings:[{keys:["g"],shiftKey:!1,ctrlKey:!0,altKey:!1,metaKey:!1,display:"Ctrl + G",os:"windows"},{os:"mac",keys:["g"],shiftKey:!1,ctrlKey:!1,altKey:!1,metaKey:!0,display:"⌘ + G"}]},{id:"undo",description:"Undo the last action.",onTrigger:t=>t.undo(),keybindings:[{keys:["z"],shiftKey:!1,ctrlKey:!0,altKey:!1,metaKey:!1,display:"Ctrl + Z"},{os:"mac",keys:["z"],shiftKey:!1,ctrlKey:!1,altKey:!1,metaKey:!0,display:"⌘ + Z"}]},{id:"redo",description:"Redo the last action.",onTrigger:t=>t.redo(),keybindings:[{keys:["y"],shiftKey:!1,ctrlKey:!0,altKey:!1,metaKey:!1,display:"Ctrl + Y"},{os:"mac",keys:["z"],shiftKey:!0,ctrlKey:!1,altKey:!1,metaKey:!0,display:"⌘ + Shift + Z"}]},{id:"toggle-grid",description:"Toggle the grid.",onTrigger:t=>t.updateGuideOptions({show:!t.guideOptions.show}),keybindings:[{keys:["g"],shiftKey:!1,ctrlKey:!1,altKey:!1,metaKey:!1,display:"G"}]},{id:"nudge-left",description:"Nudge the selected element left.",onTrigger:t=>t.nudgeElement({left:-1}),keybindings:[{keys:["arrowleft"],shiftKey:!1,ctrlKey:!1,altKey:!1,metaKey:!1,display:"←"}]},{id:"nudge-right",description:"Nudge the selected element right.",onTrigger:t=>t.nudgeElement({left:1}),keybindings:[{keys:["arrowright"],shiftKey:!1,ctrlKey:!1,altKey:!1,metaKey:!1,display:"→"}]},{id:"nudge-up",description:"Nudge the selected element up.",onTrigger:t=>t.nudgeElement({top:-1}),keybindings:[{keys:["arrowup"],shiftKey:!1,ctrlKey:!1,altKey:!1,metaKey:!1,display:"↑"}]},{id:"nudge-down",description:"Nudge the selected element down.",onTrigger:t=>t.nudgeElement({top:1}),keybindings:[{keys:["arrowdown"],shiftKey:!1,ctrlKey:!1,altKey:!1,metaKey:!1,display:"↓"}]},{id:"toggle-lock",description:"Lock and unlock selected elements.",onTrigger:t=>t.toggleSelectionLocking(),keybindings:[{keys:["l"],shiftKey:!1,ctrlKey:!0,altKey:!1,metaKey:!1,display:"Ctrl + L",os:"windows"},{os:"mac",keys:["l"],shiftKey:!1,ctrlKey:!1,altKey:!1,metaKey:!0,display:"⌘ + L"}]}];var O=i(47665);let j=t=>e=>{let{stitch:i}=e,s=(0,O.D)(()=>{f.k.debug("viewport resizing"),i.resizeEditor(t.clientWidth,t.clientHeight)},10);return s(),window.addEventListener("resize",s),()=>{window.removeEventListener("resize",s)}};function L(t,e){let i=(0,n.fabric.util.invertTransform)(t.calcTransformMatrix());n.fabric.util.addTransformToObject(e,i),e.set({absolutePositioned:!1,isEditingMask:!1}),t.set({clipPath:e})}function A(t,e){let i=t.calcTransformMatrix();n.fabric.util.addTransformToObject(e,i),e.set({absolutePositioned:!1,isEditingMask:!1,dirty:!0}),t.set({clipPath:void 0})}function P(t){return t&&"image"===t.type&&!o.Z7.includes(t.id)&&!t.clipPath}class M{init(){let t=(0,o.sQ)(this.canvas,{"object:moving":this.onObjectMoving.bind(this),"mouse:up":this.onMouseUp.bind(this),"mouse:dblclick":t=>{let{target:e}=t;return e?this.onStartEditing(e):null},"after:render":this.onAfterRender.bind(this),"selection:created":this.onObjectSelected.bind(this)});this.boundEvents.push(t)}destroy(){for(let t of this.boundEvents)t()}detachMaskFromElement(t){let e=this.stitch.getElements().find(e=>e.id===t);e&&e.clipPath&&(this.canvas.add(e.clipPath),A(e,e.clipPath),this.cleanupMask(),this.stitch.updateElement(e.id,{}))}finishEditingMask(t){let e=this.stitch.getElements().find(e=>e.id===t);e&&e.clipPath&&(L(e,e.clipPath),this.cleanupMask(),this.stitch.updateElement(e.id,{}))}startEditingMask(t){let e=this.stitch.getElements().find(e=>e.id===t);e&&this.onStartEditing(e)}cleanupMask(){this.stitch.state=r.zl.Loading,this.maskImage&&(this.maskImage.clipPath&&(this.mask=this.maskImage.clipPath,A(this.maskImage,this.maskImage.clipPath),this.canvas.add(this.mask)),this.canvas.remove(this.maskImage)),this.maskImage=null,this.maskImageIsRendered=!1,this.canvas.renderAll(),this.stitch.state=r.zl.Idle}onObjectMoving(t){let{target:e,pointer:i}=t;if(e&&i&&!e.clipPath&&P(e)){if(this.maskImage&&!this.maskImage.containsPoint(i,null,!0)){this.cleanupMask();return}if(!this.maskImageIsRendered){for(let t of(this.mask=null,this.canvas.getObjects().filter(t=>{let{isMask:i,id:s}=t;return s!==e.id&&!!i})))if(t.containsPoint(i,null,!0)){this.mask=t;break}if(!this.mask){e.set({opacity:1,dirty:!0}),this.cleanupMask();return}e.set({opacity:.5}),this.maskImage||this.maskImageIsRendered||(this.maskImageIsRendered=!0,e.clone(t=>{if(!this.mask)return;this.stitch.state=r.zl.Loading;let e=this.mask.getCenterPoint();this.maskImage=t,this.maskImage.set({id:(0,a.V)(),left:e.x-t.width/2*t.scaleX,top:e.y-t.height/2*t.scaleY,selectable:!1,evented:!1,opacity:1,clipPath:this.mask}),L(this.maskImage,this.mask),this.canvas.add(this.maskImage),this.canvas.remove(this.mask),this.stitch.state=r.zl.Idle}))}}}onMouseUp(t){var e;let{target:i}=t;i&&(null==i||!i.clipPath)&&P(i)&&this.mask&&this.maskImage&&(null===(e=i.clipPath)||void 0===e?void 0:e.absolutePositioned)!==!0&&(this.stitch.state=r.zl.Loading,this.canvas.setActiveObject(this.maskImage),this.canvas.remove(i),this.stitch.state=r.zl.Idle,this.maskImage&&(this.maskImage.set({id:i.id,selectable:!0,evented:!0}),this.maskImage=null,this.maskImageIsRendered=!1),this.mask=null,this.stitch.updateElement(i.id,{}))}onStartEditing(t){if(!t.clipPath)return;let e=t.clipPath;if(e.isEditingMask)return;(function(t,e){let i=t.calcTransformMatrix();n.fabric.util.addTransformToObject(e,i),e.set({absolutePositioned:!0,isEditingMask:!0})})(t,t.clipPath),t.on("moving",()=>(function(t,e){if(!t||!e||!t.clipPath||!1===t.clipPath.absolutePositioned)return;let i=e.getBoundingRect(!0,!0),s=t.getBoundingRect(!0,!0);s.left>i.left&&t.set({left:i.left});let r=s.left+s.width,n=i.left+i.width;r<n&&t.set({left:n-s.width}),s.top>i.top&&t.set({top:i.top});let o=s.top+s.height,a=i.top+i.height;o<a&&t.set({top:a-s.height})})(t,e));let i=()=>{t.off("moving")};this.stitch.updateElement(t.id,{fill:"transparent"});let s=()=>{e.isEditingMask&&(L(t,e),t.off("moving"),this.canvas.off(i),this.canvas.off("selection:created",s),this.stitch.updateElement(t.id,{}))},r=this.stitch.on("selectionCreated",()=>{e.isEditingMask&&(L(t,e),t.off("moving"),this.canvas.off(i),r(),this.stitch.updateElement(t.id,{}))})}onAfterRender(){this.mask&&!this.maskImageIsRendered&&(0,s.W2)(this.mask)}onObjectSelected(t){let{target:e}=t;e&&e.clipPath&&e.clipPath.isEditingMask&&(this.cleanupMask(),L(e,e.clipPath),this.stitch.updateElement(e.id,{}))}constructor(t){this.mask=null,this.maskImage=null,this.maskImageIsRendered=!1,this.boundEvents=[],this.stitch=t,this.canvas=t.canvas,this.init()}}var z=i(95035),I=i(51967);let E={preserveObjectStacking:!0,backgroundColor:"transparent",defaultCursor:"default",containerClass:"canvas-container w-full h-full"};class K{get pageId(){return this._pageId}get hasHistory(){return this._historyStack.length>1}get currentHistoryItem(){return this._historyStack[this._historyIndex]}get historyList(){return this._historyStack}get canUndo(){return this.hasHistory&&this._historyIndex>0}get canRedo(){return this.hasHistory&&this._historyIndex+1<this._historyStack.length}get renderOutsideFrame(){return this._renderOutsideFrame}get canvas(){return this._canvas}set renderOutsideFrame(t){this._renderOutsideFrame=t,this.render()}get frame(){return this._canvas.frame}get guideOptions(){return this._guideOptions}get snapWidth(){return this._snapWidth}get snapHeight(){return this._snapHeight}get zoom(){return this._zoom}set zoom(t){if(this._state===r.zl.Destroyed)return;this._zoom=t;let e=new n.fabric.Point(this._canvas.width/2,this._canvas.height/2);this._canvas.zoomToPoint(e,t),this._canvas.setZoom(t),this._emitter.emit("zoomed",t)}get viewportTransform(){return this._canvas.viewportTransform}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){var e;this._state!==r.zl.Destroyed&&(this._backgroundColor=t,null===(e=this._canvas.frame)||void 0===e||e.set("fill",t),this._canvas.requestRenderAll(),this._emitter.emit("backgroundColorChanged",t))}get width(){var t;return null===(t=this._canvas.frame)||void 0===t?void 0:t.width}get height(){var t;return null===(t=this._canvas.frame)||void 0===t?void 0:t.height}get overrides(){return structuredClone(this._overrides)}set overrides(t){this._overrides=t,this._state===r.zl.Idle&&this._emitter.emit("canvasModified")}set state(t){this._state=t}get state(){return this._state}registerPlugin(t){return t({stitch:this,canvas:this._canvas})}on(t,e){return this._state===r.zl.Destroyed?()=>null:this._emitter.on(t,e)}off(t,e){this._emitter.off(t,e)}updateGuideOptions(t){if(this._state===r.zl.Destroyed)return;this._guideOptions={...this.guideOptions,...t};let e=(0,s.Yw)(this._canvas),i=this._state;this._state=r.zl.Loading,e&&this._canvas.remove(e),this._guideOptions.show&&(0,s.Kw)(this._canvas,{gridSize:this._guideOptions.gridSize}),this._state=this._state===r.zl.Loading?i:this._state,this._emitter.emit("guideOptionsUpdated",this._guideOptions)}update(t,e){if(this._state===r.zl.Destroyed)return;let i=!1;if(t.zoom&&(this.zoom=t.zoom),t.backgroundColor&&(this.backgroundColor=t.backgroundColor,i=!0),t.overrides&&(this._canvas.overrides=t.overrides,i=!0),t.width||t.height){let e=t.width||this._canvas.frame.width,s=t.height||this._canvas.frame.height;this.resizeFrame(e,s),this.fitToScreen(),i=!0}i&&(this.render(),this._emitter.emit("canvasModified",e))}centerViewport(t){if(this._state===r.zl.Destroyed)return;let e=t||this._canvas.frame;if(!e)return;let i=e.left+e.width/2,s=e.top+e.height/2,n=-i*this.zoom+this._canvas.width/2,o=-s*this.zoom+this._canvas.height/2;this._canvas.setViewportTransform([this.zoom,0,0,this.zoom,n,o])}initStroke(t){t.stroke&&"transparent"!==t.stroke||t.set({strokeWidth:0,stroke:"#000000"})}addText(t){var e;let i,{value:a,options:l,x:c=0,y:h=0,constrained:d=!1,groupedConstrained:f=!1}=t;if(this._state===r.zl.Destroyed)return;let u={...l,text:""===a?I.bV:a,fill:null!==(e=null==l?void 0:l.fill)&&void 0!==e?e:I.Dp};return i=d?new z.f(a,{...u,top:h,left:c}):f?(0,I.gM)({textboxOptions:u,groupOptions:{top:h,left:c}}):new n.fabric.Textbox(a,{...u,top:h,left:c}),this._canvas.add(i),c||h?(0,o.H$)(i)?(i.top=h||i.top,i.left=c||i.left):i.set({left:c||i.left,top:h||i.top}):(0,s.wy)(this._canvas,i),(0,o.H$)(i)?this.initStroke(i.textbox):this.initStroke(i),i.resetAreaToText&&i.resetAreaToText(),i.dirty=!0,this._canvas.bringToFront(i),(0,o.H$)(i)?this._canvas.setActiveObject(i):d?this._canvas.setActiveObject(i.area):this._canvas.setActiveObject(i),this._emitter.emit("canvasModified"),this.render(),i}addRect(t){let{width:e,height:i,x:o,y:a,fill:l,rx:c,ry:d}=t;if(this._state===r.zl.Destroyed)return;let f=new n.fabric.Rect({width:e||100,height:i||100,fill:l||h.defaultElementColor,objectCaching:!1});return this._canvas.add(f),o&&a?f.set({left:o,top:a}):(0,s.wy)(this._canvas,f),this.initStroke(f),this._canvas.bringToFront(f),this._canvas.setActiveObject(f),this.render(),this._emitter.emit("canvasModified"),f}addCircle(t){let{x:e,y:i,fill:o,radius:a}=t;if(this._state===r.zl.Destroyed)return;let l=new n.fabric.Circle({radius:a||50,fill:o||h.defaultElementColor});return this._canvas.add(l),e&&i?l.set({left:e,top:i}):(0,s.wy)(this._canvas,l),this.initStroke(l),this._canvas.bringToFront(l),this._canvas.setActiveObject(l),this.render(),this._emitter.emit("canvasModified"),l}addLine(t){let{stroke:e=h.defaultElementColor,strokeWidth:i=5,startLineType:s=null,endLineType:r=null,strokeDashArray:n,x:o=this.width/2,y:l=this.height/2}=t,d=new c.C([o,l,o+100,l]);this._canvas.add(d),d.set({stroke:e,strokeWidth:i,startLineType:s,endLineType:r,strokeDashArray:n}),this._canvas.bringToFront(d),this._canvas.setActiveObject(d),d.id=(0,a.V)("advancedLine"),this._emitter.emit("canvasModified")}async addImage(t){if(this._state===r.zl.Destroyed)return;let e=await (0,s.po)(this._canvas,t);return this._canvas.add(e),(0,s.hj)(this._canvas,[e]),t.x&&t.y?e.set({left:t.x,top:t.y}):(0,s.wy)(this._canvas,e),e.dirty=!0,this._canvas.bringToFront(e),this._canvas.setActiveObject(e),this.render(),this._emitter.emit("canvasModified"),e}applyFilterToImage(t){let{filterId:e,imageId:i,filterOptions:s}=t,r=this.getElements().find(t=>t.id===i);if(!(0,o.Or)(r))return;r.filters||(r.filters=[]);let a=r.filters.find(t=>t.type===e)||null;a?"Composed"===e?(a.subFilters[1].color=s.highlightsColor,a.subFilters[1].alpha=s.highlightsAlpha,a.subFilters[2].color=s.shadowsColor,a.subFilters[2].alpha=s.shadowsAlpha):a.setOptions(s):(a=new n.fabric.Image.filters[e]("Composed"===e?{subFilters:[new n.fabric.Image.filters.Grayscale({mode:"luminosity"}),new n.fabric.Image.filters.BlendColor({color:s.highlightsColor,alpha:s.highlightsAlpha}),new n.fabric.Image.filters.BlendColor({color:s.shadowsColor,alpha:s.shadowsAlpha,mode:"lighten"})]}:s),r.filters.push(a)),r.applyFilters(),this._emitter.emit("elementUpdated",r),this._emitter.emit("canvasModified",{debounceHistory:!0}),this.render()}removeFilterFromImage(t){let{imageId:e,filterId:i}=t,s=this.getElements().find(t=>t.id===e);(0,o.Or)(s)&&s.filters&&(s.filters=s.filters.filter(t=>t.type!==i),s.applyFilters(),this._emitter.emit("elementUpdated",s),this._emitter.emit("canvasModified"),this.render())}async addSvg(t){if(this._state===r.zl.Destroyed)return;let e=await (0,s.WA)({url:t.src,isMask:!!t.isMask,svg:t.svg,isLegacyLogo:t.isLegacyLogo});if(!e)return;this._canvas.add(e),e.set({strokeWidth:t.strokeWidth||0,stroke:t.stroke||"transparent"}),t.isMask||e.set({fill:h.defaultElementColor});let i=Math.min(250/e.width,250/e.height);return e.set({scaleX:i,scaleY:i}),t.x&&t.y?e.set({left:t.x||0,top:t.y||0}):(0,s.wy)(this._canvas,e),(0,o.ty)(e)?(0,o.yu)(e,t=>this.initStroke(t)):this.initStroke(e),this._canvas.bringToFront(e),this._canvas.setActiveObject(e),this._state=r.zl.Idle,this.render(),this._emitter.emit("canvasModified"),e}async replaceSvgElement(t,e){if(this._state===r.zl.Destroyed)return;let i=this._canvas.getObjects().findIndex(e=>e.id===t),n=this._canvas.getObjects()[i];if(!n)return;let o=await (0,s.ng)({referenceSvg:n,...e});if(o)return this._canvas.add(o),this._disableControlNavigation=!0,(0,s.bX)(this.canvas,n),this._canvas.moveTo(o,i),this._canvas.setActiveObject(o),this._disableControlNavigation=!1,this._state=r.zl.Idle,this.render(),this._emitter.emit("canvasModified"),o}updateElementStacking(t,e){if(this._state===r.zl.Destroyed)return;let i=null;if(e){let t=this._canvas.getObjects().find(t=>t.id===e);if(!t)return;i=t}else i=this.getActiveElement();i&&(this._canvas[t](i),this._canvas.frame&&this._canvas.sendToBack(this._canvas.frame),this._emitter.emit("canvasModified"),this.render())}recalculateTextFixedWidth(t){t.fixedWidth&&t.width<t.fixedWidth?t.set("width",t.fixedWidth):t.fixedWidth&&t.width>t.fixedWidth&&t.set("fixedWidth",t.width)}async updateElement(t,e){var i;let n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._state===r.zl.Destroyed||!(n="string"==typeof t?this._canvas.getObjects().find(e=>e.id===t):t))return;let l=["angle"];for(let i in f.k.debug("Updating ".concat(t," ").concat(n.type)),e){if(l.includes(i)&&n._setOriginToCenter(),(0,o.ty)(n)||(0,o.zY)(n)){let t=s=>{s.set(i,e[i]),s.set("dirty",!0),!a.disableRecursiveUpdates&&((0,o.ty)(s)||(0,o.zY)(s))&&s.getObjects().forEach(e=>t(e))};t(n)}else n.set(i,e[i]);if((0,o.Gs)(n)||(0,o.H$)(n)){let t=(0,o.H$)(n)?n.textbox:n;if("textCase"===i&&void 0!==t.textCase){let e=(0,o.A1)(t);t.set("text",e)}if("fontSize"===i&&t.__lineWidths){let e=Math.max(...t.__lineWidths);t.width<e&&(t.set("width",e),t.set("fixedWidth",e))}if("fontSize"===i&&t.strokeWidth>0){let s=t.strokeWidth,r=t.fontSize,n=e[i],a=(0,o.Pb)(s,r,n);t.set({strokeWidth:a})}this.recalculateTextFixedWidth(t),n.recalcTextPosition&&n.recalcTextPosition()}"src"===i&&await (0,s.pn)(n,e[i]),"frame"!==n.id||"fill"!==i||(0,o.zY)(n)||(this.backgroundColor=e[i],n.set("fill",e[i]))}n.dirty=!0,n.fire("modified",{target:n}),this._emitter.emit("elementUpdated",n),this._emitter.emit("canvasModified",{debounceHistory:null!==(i=a.debounceHistory)&&void 0!==i&&i}),this.render()}nudgeElement(t){if(this._state===r.zl.Destroyed)return;let e=this.getActiveElement();!e||(0,o.cO)(e)||this.updateElement(e,{left:e.left+(t.left||0),top:e.top+(t.top||0)},{disableRecursiveUpdates:!0})}deleteSelection(){if(this._state===r.zl.Destroyed)return;let t=this.getSelectedElements();for(let e of(this._canvas.discardActiveObject(),t))this._canvas.remove(e);t.forEach(t=>this._emitter.emit("elementRemoved",t)),this._emitter.emit("canvasModified"),this.render()}getSelectedElements(){return this._state===r.zl.Destroyed?[]:this._canvas.getActiveObjects().filter(t=>!o.Z7.includes(t.id))}getActiveElement(){if(this._state===r.zl.Destroyed)return null;let t=this._canvas.getActiveObject();return t?o.Z7.includes(t.id)?null:t:null}getElements(){return this._state===r.zl.Destroyed?[]:(0,o.$3)(this._canvas.getObjects())}async duplicateSelection(){if(this._state===r.zl.Destroyed)return[];let{clonedElements:t}=await this.cloneSelection();return t.forEach(t=>{this._canvas.add(t)}),1===t.length?this._canvas.setActiveObject(t[0]):this._canvas.setActiveObject(new n.fabric.ActiveSelection(t,{canvas:this._canvas})),this._emitter.emit("canvasModified"),t}alignSelection(t){let e,{alignment:i,axis:o}=t;if(this._state===r.zl.Destroyed)return;let a=this.getActiveElement(),l=[];if(a instanceof n.fabric.ActiveSelection)e=a.getBoundingRect(!0,!1),l=a.getObjects(),this._canvas.discardActiveObject();else{if(!a)return;e={left:this._canvas.frame.left,top:this._canvas.frame.top,width:this._canvas.frame.width,height:this._canvas.frame.height},l=[a]}for(let t of((0,s.je)(l,e,i,o),l.length>1&&this._canvas.setActiveObject(new n.fabric.ActiveSelection(l,{canvas:this._canvas})),this._emitter.emit("canvasModified"),l))this._emitter.emit("elementUpdated",t);this.render()}toggleSelectionGrouping(){if(this._state===r.zl.Destroyed)return;let t=this.getActiveElement();if(t){if("activeSelection"===t.type)t.toGroup();else if("group"===t.type){let e=this._canvas.getObjects().findIndex(e=>e.id===t.id);t.toActiveSelection().getObjects().forEach((t,i)=>this._canvas.moveTo(t,e+i))}}this.render(),this._emitter.emit("canvasModified");let e=this.getActiveElement();e&&this._emitter.emit("selectionUpdated",e,{disableControlNavigation:this._disableControlNavigation})}async loadPage(t){let{preserveHistory:e,skipHistoryTrack:i,tightBounds:n,convertToBasicTextboxes:a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._state=r.zl.Loading;let l=this._pageId,c=t.id;this._pageId=c,this.overrides=t.overrides,await (0,s.uY)(this._canvas,t,!1),n&&(0,o.w0)(this._canvas),a&&(0,o.Tq)(this._canvas),this.guideOptions.show&&this.updateGuideOptions(this.guideOptions),this._backgroundColor=t.background||this._backgroundColor,this.resizeEditor(this._viewport.clientWidth,this._viewport.clientHeight),this.fitToScreen(void 0,.8),e||this.initializeHistory(l,c),this.state=r.zl.Idle,e&&this._emitter.emit("canvasModified",{skipHistoryTrack:i}),this._emitter.emit("canvasLoaded"),this._emitter.emit("dimensionsChanged",{width:t.width,height:t.height})}fitToScreen(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(this._state===r.zl.Destroyed)return;let i=t||this._canvas.frame;return this._zoom=(0,o.VZ)(this._canvas,i,e),this._emitter.emit("zoomed",this._zoom),this._zoom}resizeEditor(t,e){this._state!==r.zl.Destroyed&&(this._canvas.setWidth(t),this._canvas.setHeight(e),this._canvas.frame&&this.fitToScreen(void 0,.8),this.render())}resizeFrame(t,e){var i;if(this._state===r.zl.Destroyed)return;let s=this._canvas,a=s.frame;a.set({width:t,height:e}),a.setCoords();let l=this.getElements(),c=new n.fabric.ActiveSelection(l,{canvas:s});this._canvas.setActiveObject(c);let h=a.left+a.width/2,d=a.top+a.height/2,f=t/c.width,u=e/c.height,g=c.width*f,p=c.height*f,m=f;p>e&&(g=c.width*u,p=c.height*u,m=u);let v=h-g/2,y=d-p/2;c.set({left:v,top:y,scaleX:m,scaleY:m}),this.fitToScreen(a,.8),this._canvas.discardActiveObject(),this._canvas.renderAll(),null===(i=c._objects)||void 0===i||i.forEach(t=>{if((0,o.Gs)(t)){let e=t.width*t.scaleX;(0,o.mv)(t,e)}else"advancedLine"===t.type&&t.set({scaleX:1,scaleY:1,x1:t.x1*m,x2:t.x2*m,y1:t.y1*m,y2:t.y2*m})}),this._emitter.emit("dimensionsChanged",{width:t,height:e}),this._emitter.emit("canvasModified")}async cutSelectionToClipboard(){if(this._state===r.zl.Destroyed)return;let{clonedElements:t,selectedElements:e}=await this.cloneSelection();t.length>0&&(this._clipboard=t,this._canvas.discardActiveObject(),this._canvas.remove(...e),this._emitter.emit("canvasModified"),this.render())}async copySelectionToClipboard(){if(this._state===r.zl.Destroyed)return;let{clonedElements:t}=await this.cloneSelection();t.length>0&&(this._clipboard=t)}async pasteSelectionFromClipboard(){if(this._state===r.zl.Destroyed)return;if(this._state=r.zl.Loading,0===this._clipboard.length){this._state=r.zl.Idle;return}for(let t of this._clipboard){let e=t.left,i=t.top;this._canvas.add(t),t.set({left:e,top:i,dirty:!0}),(0,o.XS)(t)}let t=new n.fabric.ActiveSelection(this._clipboard,{canvas:this._canvas});this._state=r.zl.Idle,this._canvas.setActiveObject(t),await this.copySelectionToClipboard(),this._emitter.emit("canvasModified"),this.render()}render(){this._state!==r.zl.Destroyed&&this._canvas.requestRenderAll()}destroy(){var t;null===(t=this._detachKeyboardShortcuts)||void 0===t||t.call(this),this._maskManager.destroy(),this._canvas.dispose(),this._state=r.zl.Destroyed}toJSON(){return(0,o.p1)(this._canvas,this._canvas.frame,this._overrides)}selectElementById(t){let e=this._canvas.getObjects().find(e=>e.id===t);e&&(this._canvas.setActiveObject(e),this.render())}async clone(t){if(0===t.length)return[];let e=[];for(let i of t){let t=await new Promise(t=>null==i?void 0:i.clone(e=>t(e),o.D8));t.set({id:(0,a.V)(t.type),top:t.top+50,left:t.left+50,dirty:!0}),e.push(t)}return e}async cloneSelection(){let t=this.getSelectedElements();this._canvas.discardActiveObject();let e=await this.clone(t);return 1===t.length?this._canvas.setActiveObject(t[0]):this._canvas.setActiveObject(new n.fabric.ActiveSelection(t,{canvas:this._canvas})),{selectedElements:t,clonedElements:e}}save(){this._emitter.emit("saved")}detachMask(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1],i=this._canvas.getObjects().find(e=>e.id===t);if(i){if(i.clipPath){let s=i.clipPath;if(e){let t=i.calcTransformMatrix();n.fabric.util.addTransformToObject(s,t),this._canvas.add(s)}i.clipPath=void 0,this.selectElementById(t)}this._emitter.emit("canvasModified"),this._emitter.emit("elementUpdated",i),this.render()}}enterMaskEditingMode(t){this._maskManager.startEditingMask(t),this.updateElement(t,{})}toggleSelectionLocking(){let t=this.getSelectedElements(),e=t.map(t=>t.id),i=t.some(o.cO);e.forEach(e=>{let s=t.find(t=>t.id===e);s&&(this.updateElement(s.id,{lockMovementX:!i,lockMovementY:!i,lockScalingX:!i,lockScalingY:!i,lockSkewingX:!i,lockSkewingY:!i,lockRotation:!i,hasControls:i}),(0,o.XS)(s))}),this._emitter.emit("canvasModified")}applyColors(t,e){if(this._state===r.zl.Destroyed)return;let i=[...t],s=e||this.getElements(),n=this.getUsedColors();if(n.length>i.length){let t=n.length-i.length;for(let e=0;e<t;e++){let t,s=0,r=!1;for(;!r&&s<10;)t=(0,l.Qg)(i[e],.8).toLowerCase(),i.includes(t)?s++:(r=!0,i.push(t));if(!r){let[e,s,r]=(0,l.Zy)();t=(0,l.vq)(e,s,r).toLowerCase(),i.push(t)}}}let a={};if(n.forEach((t,e)=>{let s=t;if((0,l.g8)(s)){let t=(0,l.$z)(s);t&&(s=t)}a[s]=i[(e+1)%i.length]}),!e){let t=this.backgroundColor.toLowerCase();this.backgroundColor=a[t]}for(let t of s)(0,o.yu)(t,t=>{if((0,o.ty)(t))return;let e=this.getElementColors(t),i=t.shadow;i&&"string"!=typeof i&&e.shadow&&(i.color=a[e.shadow]);let s={fill:e.fill&&a[e.fill]?a[e.fill]:e.fill,stroke:e.stroke&&a[e.stroke]?a[e.stroke]:e.stroke,shadow:e.shadow&&a[e.shadow]?i:t.shadow};this.updateElement(t,s,{debounceHistory:!0})});this.render()}createHistoryItem(){return{id:(0,a.V)("history"),page:this.toJSON(),timestamp:new Date,width:this.width,height:this.height}}initializeHistory(t,e){t&&this._historyMap[t]&&(this._historyMap[t].index=this._historyIndex,this._historyMap[t].stack=this._historyStack);let i=this._historyMap[e];if(!i||0===i.stack.length){let t=[this.createHistoryItem()],i={stack:t,index:t.length-1};this._historyMap[e]=i}this._historyStack=this._historyMap[e].stack,this._historyIndex=this._historyMap[e].index,this._emitter.emit("historyUpdated")}trackHistory(){this._historyStack.push(this.createHistoryItem()),this._historyStack.length>100&&(this._historyStack=this._historyStack.slice(-100)),this._historyIndex=this._historyStack.length-1,this._emitter.emit("historyTracked"),this._emitter.emit("historyUpdated")}debounceTrackHistory(){clearTimeout(this._trackHistoryDebounce),this._trackHistoryDebounce=setTimeout(()=>{this.trackHistory()},250)}async undo(){if(!this.canUndo)return;let t=this._historyIndex-1;this.jumpToHistoryIndex(t,()=>this._emitter.emit("historyUndone"))}async redo(){if(!this.canRedo)return;let t=this._historyIndex+1;this.jumpToHistoryIndex(t,()=>this._emitter.emit("historyRedone"))}async jumpToHistoryId(t,e){let i=this._historyStack.findIndex(e=>e.id===t);-1!==i&&this.jumpToHistoryIndex(i,e)}async jumpToHistoryIndex(t,e){var i;let s=t!==this._historyIndex,n=t>=0&&t<this._historyStack.length;if(!this.hasHistory||!s||!n)return;this._state=r.zl.Loading;let o=(null===(i=this.getActiveElement())||void 0===i?void 0:i.id)||null,a=this._historyStack[t];a&&(this._historyIndex=t,await this.loadPage(a.page,{preserveHistory:!0,skipHistoryTrack:!0}),o&&this.selectElementById(o)),this._state=r.zl.Idle,this._emitter.emit("historyJumped"),this._emitter.emit("historyUpdated"),e&&e(),this.render()}getUsedColors(){let t=this.getElements().reduce((t,e)=>{let i=(0,o.H$)(e)?e.textbox:e,s=i.fill,r=i.stroke,a=i.shadow;if("string"==typeof s&&(s=s.toLowerCase())&&!(0,l.g8)(s)&&t.add(s),s&&"string"!=typeof s&&(0,o.H3)(s)&&s.colorStops&&(s=s.colorStops[0].color.toLowerCase(),t.add(s)),"string"==typeof r&&(r=r.toLowerCase())&&i.strokeWidth&&!(0,l.g8)(r)&&t.add(r),r&&"string"!=typeof r&&(0,o.H3)(r)){let e=r;e.colorStops&&(r=e.colorStops[0].color.toLowerCase(),t.add(r))}if(a instanceof n.fabric.Shadow&&"string"==typeof(null==a?void 0:a.color)){a.color=a.color.toLowerCase();let e=a.offsetX||a.offsetY||a.blur;a.color&&e&&!(0,l.g8)(a.color)&&t.add(a.color)}return t},new Set);return((0,l.Ff)(this.backgroundColor)||(0,l.g8)(this.backgroundColor))&&t.add(this.backgroundColor.toLowerCase()),Array.from(t).filter(t=>"transparent"!==t)}getElementColors(t){let e={fill:void 0,stroke:void 0,shadow:void 0},i=t.fill,s=t.stroke,r=t.shadow;if("string"==typeof i&&(i=i.toLowerCase(),(0,l.g8)(i)?e.fill=(0,l.$z)(i):e.fill=i),i&&"string"!=typeof i&&(0,o.H3)(i)&&i.colorStops&&(e.fill=i.colorStops[0].color.toLowerCase()),"string"==typeof s&&(s=s.toLowerCase(),(0,l.g8)(s)?e.stroke=(0,l.$z)(s):e.stroke=s),s&&"string"!=typeof s&&(0,o.H3)(s)){let t=s;t.colorStops&&(e.stroke=t.colorStops[0].color.toLowerCase())}return r instanceof n.fabric.Shadow&&"string"==typeof(null==r?void 0:r.color)&&(r.color=r.color.toLowerCase(),(0,l.g8)(r.color)&&(r.color=(0,l.$z)(r.color)),e.shadow=r.color),e}getKeyboardShortcuts(){return this._keyboardShortcuts}attachKeyboardShortcuts(t){this._detachKeyboardShortcuts&&this._detachKeyboardShortcuts();let e=e=>{if(f.k.debug("Key pressed: ".concat(e.key)),!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)&&e.key){for(let i of t)if(i.keybindings.some(t=>t.keys.includes(e.key.toLowerCase())&&!!t.ctrlKey==!!e.ctrlKey&&!!t.metaKey==!!e.metaKey&&!!t.shiftKey==!!e.shiftKey&&!!t.altKey==!!e.altKey)){f.k.debug("Keybinding triggered: ".concat(i.id)),i.onTrigger(this),e.preventDefault(),e.stopPropagation();break}}};window.addEventListener("keydown",e),this._detachKeyboardShortcuts=()=>{window.removeEventListener("keydown",e),this._detachKeyboardShortcuts=null}}constructor(t){if(this._state=r.zl.Uninitialized,this._keyboardShortcuts=S,this._detachKeyboardShortcuts=null,this._historyMap={},this._historyIndex=0,this._historyStack=[],this._trackHistoryDebounce=void 0,this._snapWidth=10,this._snapHeight=10,this._clipboard=[],this._overrides={},this._renderOutsideFrame=!1,this._disableControlNavigation=!1,this._pageId=(0,a.V)("page"),this._guideOptions={snapToGrid:!0,gridSize:{width:100,height:100},snapToCenter:!0,snapToEdges:!0,snapToObjects:!0,show:!1},this._zoom=1,this._backgroundColor="transparent",t.logLevel&&f.k.setLevel(t.logLevel),this._viewport=t.viewport,this._emitter=function(t){let e={},i=(t,i)=>{var r;return void 0===e[t]&&(e[t]=[]),null===(r=e[t])||void 0===r||r.push(i),()=>{s(t,i)}},s=(t,i)=>{var s,r,n;let o=null!==(n=null===(s=e[t])||void 0===s?void 0:s.indexOf(i))&&void 0!==n?n:-1;null===(r=e[t])||void 0===r||r.splice(o>>>0,1)};return{on:i,off:s,once:(t,e)=>{let r=i=>{e(i),s(t,r)};i(t,r)},emit:(i,s)=>{var r;null===(r=e[i])||void 0===r||r.forEach(e=>{try{e(s)}catch(e){null==t||t.onError(e)}})}}}({onError:console.error}),this._canvas=new n.fabric.Canvas(t.canvas,E),this._lineManager=new d(this._canvas),t.keyboardShortcuts&&(this._keyboardShortcuts=t.keyboardShortcuts),n.fabric.Object.prototype.objectCaching=!1,(0,s.wZ)(this._canvas),this._canvas.on("mouse:down",()=>{this._state===r.zl.Idle&&this._emitter.emit("mouseDown")}),this._canvas.on("mouse:up",()=>{this._state===r.zl.Idle&&this._emitter.emit("mouseUp")}),this._canvas.on("selection:created",t=>{if(this._state!==r.zl.Idle)return;let e=this._canvas.getActiveObject();if((0,o.zY)(e)){let t=e,i=this.getElements().filter(e=>{var i;return null===(i=t._objects)||void 0===i?void 0:i.find(t=>t.id===e.id)}),s=i.filter(t=>!(0,o.cO)(t));if(0===s.length)this._canvas.discardActiveObject();else if(s.length!==i.length){this._canvas.discardActiveObject();let t=s[0];s.length>1&&(t=new n.fabric.ActiveSelection(s,{canvas:this._canvas})),this._canvas.setActiveObject(t),e=t}}e&&!(0,o.Oz)(e)&&this._emitter.emit("selectionCreated",e)}),this._canvas.on("object:rotating",t=>{let{target:e,e:i}=t;this._state===r.zl.Idle&&e&&(e.controls.mtr.isRotating=!0,i.shiftKey||i.ctrlKey?e.snapAngle=i.shiftKey?h.shiftSnapAngle:h.ctrlSnapAngle:e.snapAngle=0)}),this._canvas.on("selection:updated",t=>{if(this._state!==r.zl.Idle)return;let e=this._canvas.getActiveObject();if((0,o.zY)(e)){let t=e,i=this.getElements().filter(e=>{var i;return null===(i=t._objects)||void 0===i?void 0:i.find(t=>t.id===e.id)}),s=i.filter(t=>!(0,o.cO)(t));if(0===s.length)this._canvas.discardActiveObject();else if(s.length!==i.length){this._canvas.discardActiveObject();let t=new n.fabric.ActiveSelection(s,{canvas:this._canvas});this._canvas.setActiveObject(t),e=t}}e&&!(0,o.Oz)(e)&&this._emitter.emit("selectionUpdated",e,{disableControlNavigation:this._disableControlNavigation})}),this._canvas.on("selection:cleared",()=>{this._state===r.zl.Idle&&this._emitter.emit("selectionCleared",{disableControlNavigation:this._disableControlNavigation})}),this._canvas.on("object:added",t=>{if(t.target){if((0,o.XS)(t.target),t.target.set("strokeUniform",!0),!t.target.id){var e;t.target.set("id",(0,a.V)(null===(e=t.target)||void 0===e?void 0:e.type))}if(t.target.styles&&t.target.set("styles",{}),(0,o.Gs)(t.target)||(0,o.H$)(t.target)){let e=(0,o.H$)(t.target)?t.target.textbox:t.target;e.fixedWidth||e.set("fixedWidth",e.width),t.target.maxFontSize||e.set("maxFontSize",e.fontSize),(0,o.v2)({target:t.target})}}if(this._state!==r.zl.Idle)return;let i=t.target;this._emitter.emit("elementAdded",i)}),this._canvas.on("object:modified",t=>{var e;this._state===r.zl.Idle&&t.target&&(null===(e=t.target.controls)||void 0===e?void 0:e.mtr)&&(t.target.controls.mtr.isRotating=!1,t.target.snapAngle=0)}),this._canvas.on("object:modified",t=>{if(this._state!==r.zl.Idle)return;let e=t.target;(0,o.Oz)(e)||(this._emitter.emit("elementUpdated",e),this._emitter.emit("canvasModified"))}),this._canvas.on("object:modified",t=>{this._state===r.zl.Idle&&t.target&&((0,o.Gs)(t.target)||(0,o.H$)(t.target))&&(t.target.overridesApplied=void 0)}),this._canvas.on("text:changed",t=>{if(this._state!==r.zl.Idle)return;let e=t.target;if((0,o.Gs)(e)&&this.recalculateTextFixedWidth(e),(0,o.Gs)(e)&&void 0!==e.textCase){let t=(0,o.A1)(e);e.set("text",t)}if((0,o.H$)(e)){let{textbox:t}=e;if(void 0!==t.textCase){let e=(0,o.A1)(t);t.set("text",e)}this._emitter.emit("elementUpdated",e),this._emitter.emit("canvasModified")}}),this._canvas.on("object:scaling",t=>{if(this._state!==r.zl.Idle)return;let e=t.target;if((0,o.Ep)(e)){let t=e.width*e.scaleX,i=e.height*e.scaleY;e.set({width:t,height:i,scaleX:1,scaleY:1,dirty:!0}),this.render()}else(0,o.gw)(e)&&e.set({radius:e.radius*e.scaleX,scaleX:1,scaleY:1});this._emitter.emit("elementScaled",e),this.render()}),this._canvas.on("after:render",()=>{this._state===r.zl.Idle&&this._emitter.emit("rendered")}),this._canvas.on("object:removed",t=>{if(this._state!==r.zl.Idle)return;let e=t.target;this._emitter.emit("elementRemoved",e)}),this._emitter.on("canvasModified",t=>{this._state!==r.zl.Idle||null!=t&&t.skipHistoryTrack||(this.canRedo&&(this._historyStack=this._historyStack.slice(0,this._historyIndex+1)),(null==t?void 0:t.debounceHistory)?this.debounceTrackHistory():this.trackHistory())}),t.plugins)for(let e of t.plugins)this.registerPlugin(e);else this.registerPlugin(j(t.viewport)),this.registerPlugin(u),this.registerPlugin(k),this.registerPlugin(T),this.registerPlugin(C);this.attachKeyboardShortcuts(this._keyboardShortcuts),this._maskManager=new M(this),this._state=r.zl.Idle}}let W=n.fabric.util.createClass(n.fabric.StaticCanvas,{initialize(t,e){this.callSuper("initialize",t,e),this._attachEvents()},_attachEvents(){this.on("object:added",t=>{let{target:e}=t;if(e.set("strokeUniform",!0),e.id||e.set("id",(0,a.V)(null==e?void 0:e.type)),e.styles&&e.set("styles",{}),(0,o.Gs)(e)||(0,o.H$)(e)){let t=(0,o.H$)(e)?e.textbox:e;t.fixedWidth||t.set("fixedWidth",e.width),e.maxFontSize||t.set("maxFontSize",e.fontSize),(0,o.v2)({target:e})}})}})},14127:function(t,e,i){"use strict";i.d(e,{k:function(){return s}});let s=new(i(10196)).Y("stitch","debug")},90690:function(t,e,i){"use strict";i.d(e,{je:function(){return _},uj:function(){return p},wy:function(){return b},hj:function(){return O},WA:function(){return j},ng:function(){return L},Kw:function(){return C},Yw:function(){return T},Op:function(){return M},wZ:function(){return y},po:function(){return S},uY:function(){return k},bX:function(){return A},pn:function(){return z},W2:function(){return P}});var s=i(95035),r=i(76948),n=i(29653),o=i(47113),a=i(81052),l=i(7344);let c=t=>void 0!==t.value,h=t=>void 0!==t.name,d=t=>void 0!==t.children,f=t=>!!c(t)&&"The Noun Project"===t.value||(!h(t)||"text"===t.name||"tspan"===t.name||"g"===t.name)&&!!d(t)&&t.children.length>0&&t.children.some(t=>f(t)),u=[{name:"removeNounProjectTemplateGroup",fn:()=>({element:{enter:(t,e)=>{"g"===t.name&&f(t)&&(e.children=e.children.filter(e=>e!==t))}}})},{name:"removeFillNone",fn:()=>({element:{enter:(t,e)=>{var i;(null===(i=t.attributes)||void 0===i?void 0:i.fill)==="none"&&(e.children=e.children.filter(e=>e!==t))}}})},{name:"preset-default",params:{overrides:{mergePaths:!1}}}];var g=i(51967);let p=(t,e)=>{let i=t*.999**e;return i>3&&(i=3),i<.1&&(i=.1),i},m=t=>function(e,i,s,r,n){let o=l.fabric.Object.prototype.cornerSize||0,a=this.isRotating,c=a?"#fff":l.fabric.Object.prototype.cornerColor;if(e.save(),e.beginPath(),e.arc(i,s,o/2+4,0,2*Math.PI,!1),e.fillStyle=c,e.closePath(),e.lineWidth=2,e.fill(),e.stroke(),e.restore(),a){e.fillStyle="#333",e.translate(i,s),e.font="9px sans-serif";let t="".concat(Math.floor((null==n?void 0:n.angle)||0)),r=e.measureText(t);e.fillText(t,-r.width/2,5)}else e.save(),e.translate(i,s),e.rotate(l.fabric.util.degreesToRadians(n.angle||0)),e.drawImage(t,-o/2,-o/2,o,o);e.restore()};function v(t,e,i,s,r){let n=l.fabric.Object.prototype.cornerSize||0,o=l.fabric.Object.prototype.cornerColor;t.save(),t.translate(e,i),t.rotate(l.fabric.util.degreesToRadians(r.angle||0)),t.beginPath(),t.arc(-1,n/2,n/4+2,0,Math.PI,!1),t.arc(-1,-n/2,n/4+2,Math.PI,0,!1),t.fillStyle=o,t.lineWidth=2,t.fill(),t.restore()}let y=t=>{let e=document.createElement("img");e.src="/shapes/controls/rotate.svg",l.fabric.Object.prototype.borderColor="#1890ff",l.fabric.Object.prototype.cornerColor="#1890ff",l.fabric.Object.prototype.transparentCorners=!1,l.fabric.Object.prototype.cornerStyle="circle",l.fabric.Object.prototype.borderScaleFactor=2,l.fabric.Object.prototype.cornerSize=15,l.fabric.Object.prototype.padding=0,l.fabric.Object.prototype.noScaleCache=!1,l.fabric.Object.prototype.hoverCursor="default",l.fabric.ActiveSelection.prototype._controlsVisibility={...l.fabric.ActiveSelection.prototype._controlsVisibility,ml:!1,mr:!1,mt:!1,mb:!1},t.selectionBorderColor="#1890ff",t.selectionColor="rgba(24, 144, 255, 0.07)",t.selection=!0,l.fabric.textureSize=8192,l.fabric.Object.prototype.controls.mtr=new l.fabric.Control({actionHandler:l.fabric.controlsUtils.rotationWithSnapping,render:m(e),withConnection:!0,cursorStyle:"pointer",actionName:"rotate",offsetY:40,offsetX:0,y:.5,x:0,isRotating:!1}),function(){let t=l.fabric.controlsUtils.wrapWithFixedAnchor(o.wh),e=l.fabric.controlsUtils.scaleCursorStyleHandler,i="customTextboxControl";l.fabric.Textbox.prototype.controls={mtr:l.fabric.Object.prototype.controls.mtr,tr:new l.fabric.Control({cursorStyleHandler:e,actionHandler:l.fabric.controlsUtils.wrapWithFixedAnchor(o.yr),actionName:i,x:.5,y:-.5}),tl:new l.fabric.Control({cursorStyleHandler:e,actionHandler:l.fabric.controlsUtils.wrapWithFixedAnchor(o.yr),actionName:i,x:-.5,y:-.5}),br:new l.fabric.Control({cursorStyleHandler:e,actionHandler:l.fabric.controlsUtils.wrapWithFixedAnchor(o.yr),actionName:i,x:.5,y:.5}),bl:new l.fabric.Control({cursorStyleHandler:e,actionHandler:l.fabric.controlsUtils.wrapWithFixedAnchor(o.yr),actionName:i,x:-.5,y:.5}),mr:new l.fabric.Control({cursorStyleHandler:e,actionHandler:t,actionName:i,render:v,x:.5,y:0}),ml:new l.fabric.Control({cursorStyleHandler:e,actionHandler:t,actionName:i,render:v,x:-.5,y:0})}}(),l.fabric.AdvancedLine=r.C,l.fabric.ConstrainedTextbox=s.f,l.fabric.GroupedConstrainedTextbox=g.j7,l.fabric.AdvancedLine.fromObject=function(t,e){let i=new r.C([t.x1,t.y1,t.x2,t.y2],t);i.id=t.id,i.startLineType=t.startLineType,i.endLineType=t.endLineType,i.strokeWidth=t.strokeWidth,i.lockScalingX=t.lockScalingX,i.lockScalingY=t.lockScalingY,i.fill=t.fill,i.stroke=t.stroke,i.strokeDashArray=t.strokeDashArray,i.strokeLineCap=t.strokeLineCap,i.strokeLineJoin=t.strokeLineJoin,i.strokeMiterLimit=t.strokeMiterLimit,i.strokeUniform=t.strokeUniform,i.top=t.top,i.left=t.left,i.scaleX=t.scaleX,i.scaleY=t.scaleY,e&&e(i)},l.fabric.Circle.prototype._controlsVisibility={...l.fabric.Circle.prototype._controlsVisibility,ml:!1,mr:!1,mt:!1,mb:!1}},b=(t,e)=>{_([e],{top:t.frame.top,left:t.frame.left,width:t.frame.width,height:t.frame.height},n.v2.Center,n.RD.X),_([e],{top:t.frame.top,left:t.frame.left,width:t.frame.width,height:t.frame.height},n.v2.Center,n.RD.Y)},_=(t,e,i,s)=>{t.forEach(t=>{let{top:r,left:o,width:a,height:c}=e,h=t.left,d=t.top,f=t.originX,u=t.originY;switch(i){case n.v2.Top:d=r,u="top";break;case n.v2.Bottom:d=r+c,u="bottom";break;case n.v2.Left:h=o,f="left";break;case n.v2.Right:h=o+a,f="right";break;case n.v2.Center:s===n.RD.X?(h=o+a/2,f="center"):(d=r+c/2,u="center")}t.setPositionByOrigin(new l.fabric.Point(h,d),f,u),t.setCoords()})},x=t=>{let e=2*t,i='<svg xmlns="http://www.w3.org/2000/svg" width="'.concat(e,'" height="').concat(e,'" viewBox="0 0 ').concat(e," ").concat(e,'">\n    <rect shape-rendering="cripsEdges" x="0" y="0" width="').concat(t,'" height="').concat(t,'" fill="#dadadaaa" />\n    <rect shape-rendering="cripsEdges" x="').concat(t,'" y="0" width="').concat(t,'" height="').concat(t,'" fill="#f3f3f3aa" />\n    <rect shape-rendering="cripsEdges" x="').concat(t,'" y="').concat(t,'" width="').concat(t,'" height="').concat(t,'" fill="#dadadaaa" />\n    <rect shape-rendering="cripsEdges" x="0" y="').concat(t,'" width="').concat(t,'" height="').concat(t,'" fill="#f3f3f3aa" />\n  </svg>\n  '),s=new Image;return s.src="data:image/svg+xml;base64,".concat(btoa(i)),s.width=e,s.height=e,new l.fabric.Pattern({source:s,repeat:"repeat",patternTransform:[.3,0,0,.3,0,0]})},w=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{width:e=600,height:i=600,fill:s="#ffffff",stroke:r="#dadada"}=t;return new l.fabric.Rect({id:"frame",width:e,height:i,fill:s,stroke:r,isFrame:!0,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,hasControls:!1,selectable:!1,evented:!1})},k=async function(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=await (0,o.lz)(e),n=e.background||"white",l=e.overrides,c=new Set,h=e.objects.map(t=>{let e={...t};return c.has(t.id)&&(e.id=(0,a.V)(t.type)),(0,o.Gs)(e)&&e.type!==s.X&&(e.type="textbox",e.splitByGrapheme=!1),c.add(e.id),e});return t.clear(),new Promise((s,a)=>{try{t.loadFromJSON({...e,objects:h},async()=>{let{width:a,height:c}=e;t.set({overrides:l,width:a,height:c}),t.frame&&t.remove(t.frame);let h=w({width:a,height:c,fill:n});i||(await new Promise(e=>{t.setBackgroundColor("rgba(249, 250, 251, 0.2)",e)}),await new Promise(e=>{t.setBackgroundImage(h,e)}),t.frame&&t.remove(t.frame),t.add(h),h.sendToBack()),t.frame=h,t.getObjects().forEach(t=>{(0,o.cO)(t)&&(t.hasControls=!1),(0,o.H$)(t)&&t.overridesApplied&&(t.splitTextIntoMaxOverrideLines(),t.recalcTextPosition())}),s({frame:h,fonts:r})})}catch(t){a(t)}})},T=t=>t.getObjects().find(t=>"grid"===t.id)||null,C=function(t){var e,i;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=(null===(e=s.gridSize)||void 0===e?void 0:e.width)||50,n=(null===(i=s.gridSize)||void 0===i?void 0:i.height)||50,o=t.frame,c=T(t);c&&t.remove(c);let h=t.getActiveObject(),{height:d=1,width:f=1}=o,u=[];for(let t=0;t<f/r;t++){let e=t*r;u.push(new l.fabric.Line([e,0,e,d],{id:(0,a.V)("line"),stroke:"#dadada"}))}for(let t=0;t<d/n;t++){let e=t*n;u.push(new l.fabric.Line([0,e,f,e],{id:(0,a.V)("line"),stroke:"#dadada"}))}let g=new l.fabric.Group(u,{selectable:!1,evented:!1,id:"grid"});t.add(g),g.bringToFront(),h&&t.setActiveObject(h)},S=async(t,e)=>new Promise(async(t,i)=>{l.fabric.Image.fromURL(e.src,s=>{if(0===s.width||0===s.height)return i("Image failed to load");s.set({id:(0,a.V)("image"),srcFromAttribute:!0,crossOrigin:"anonymous"}),e.uploadId&&s.set("uploadId",e.uploadId),e.overrides&&s.set("overrides",e.overrides),t(s)},{crossOrigin:"anonymous"})}),O=(t,e)=>{let i=e.length?e:(0,o.$3)(t.getObjects()),s=t.frame,r=.5*t.width,n=.5*t.height;s&&(r=s.width,n=s.height);let a=r/n,c=t.getZoom()||1;t.setZoom(1);let h=new l.fabric.ActiveSelection(i,{id:"active",canvas:t});h&&((h.width||1)/(h.height||1)<=a?(h.height||0>n)&&h.scaleToHeight(n):(h.width||0>r)&&h.scaleToWidth(r),h.destroy(),t.setZoom(c),t.discardActiveObject())},j=async t=>new Promise(async(e,s)=>{var r;if(!t.url&&!t.svg)return s("No URL or SVG provided");if(t.url&&t.svg)return s("Cannot provide both a URL and an SVG");let{url:n,svg:o}=t,c=null,h=(t,e)=>{if(!t||!e)return!1;let i=t.left,s=t.top,r=t.left+t.width,n=t.top+t.height,o=e.left,a=e.top,l=e.left+e.width,c=e.top+e.height;return i<=l&&r>=o&&s<=c&&n>=a},d=o||"";n&&(d=await fetch(n).then(t=>t.text()));let{optimize:f}=await Promise.all([i.e(8363),i.e(6331)]).then(i.t.bind(i,18363,19)),g=f(d,{multipass:!0,plugins:u,floatPrecision:2}),p=(null===(r=new DOMParser().parseFromString(g.data,"text/html").querySelector("svg"))||void 0===r?void 0:r.getAttribute("viewBox"))||"";if(p){let t=p.split(" ");4===t.length&&((c={left:parseInt(t[0]),top:parseInt(t[1]),width:parseInt(t[2]),height:parseInt(t[3])}).left=0,c.top=0)}l.fabric.loadSVGFromString(g.data,i=>{let s=i.filter(t=>{let e=t.getBoundingRect();return(!c||!!h(e,c))&&"background"!==t.id&&"tight-bounds"!==t.id&&t});0===s.length&&e(null);let r=l.fabric.util.groupSVGElements(s);r.id=(0,a.V)("group"),r.set(t);let n=e=>{if(t.isMask){let t=x(Math.round(r.width/5));e.set({fill:t})}};r._objects?r._objects.forEach(n):n(r),r.id=(0,a.V)("svg"),e(r)})}),L=async t=>{let e=t.referenceSvg;if(!e)return;let i=await j({url:t.src,svg:t.svg});if(!i)return;let s={fill:e.fill,stroke:e.stroke,strokeWidth:e.strokeWidth?1:0,opacity:e.opacity};(0,o.yu)(i,t=>{t.set(s)});let r=t.width||e.width*e.scaleX,n=t.height||e.height*e.scaleY,a=Math.min(r/i.width,n/i.height),l=e.angle;i.set({scaleX:a,scaleY:a,angle:l});let c=e.getCenterPoint();return i.setPositionByOrigin(c,"center","center"),i},A=(t,e)=>{let i=e||t.getActiveObject();return i.clipPath?(i.set({clipPath:void 0}),i):(i.set({selectable:!1,evented:!1,visible:!1}),t.remove(i),null)},P=t=>{var e;if(!t||o.Z7.includes(t.id))return;let i=null===(e=t.canvas)||void 0===e?void 0:e.contextTop;t._renderControls(i,{hasControls:!1})},M=t=>{var e,i;!t||o.Z7.includes(t.id)||(null===(e=t.canvas)||void 0===e||e.clearContext(t.canvas.contextTop),null===(i=t.canvas)||void 0===i||i.requestRenderAll())},z=(t,e)=>{let i=t.width*t.scaleX,s=t.height*t.scaleY,r=t.getSrc();return new Promise((n,o)=>{t.setSrc(e,e=>{let{width:a,height:l}=e;if(0===a||0===l)return t.setSrc(r,()=>o("Image failed to load"));let c=Math.min(i/a,s/l),h=i/2-a*c/2,d=s/2-l*c/2;t.set({scaleX:c,scaleY:c,height:l,width:a}),t.left+=h,t.top+=d,n()},{crossOrigin:"anonymous"})})}},29653:function(t,e,i){"use strict";var s,r,n,o,a,l,c,h,d,f,u,g,p,m;i.d(e,{AR:function(){return r},G_:function(){return n},KP:function(){return o},RD:function(){return c},a3:function(){return a},dN:function(){return v},v2:function(){return l},zl:function(){return s}});let v=["path","polygon","rect","circle","ellipse"];(h=s||(s={})).Uninitialized="uninitialized",h.Idle="idle",h.Loading="loading",h.Dragging="dragging",h.Destroyed="destroyed",(d=r||(r={})).Start="start",d.End="end",(f=n||(n={})).ArrowSmall="arrow-sm",f.Bar="bar",f.Arrow="arrow",f.Circle="circle",(u=o||(o={})).Sepia="Sepia",u.Grayscale="Grayscale",u.BlendColor="BlendColor",u.Polaroid="Polaroid",u.Vintage="Vintage",u.Blur="Blur",u.Duotone="Composed",(g=a||(a={})).Rect="rect",g.Circle="circle",(p=l||(l={})).Top="top",p.Bottom="bottom",p.Left="left",p.Right="right",p.Center="center",(m=c||(c={})).X="x",m.Y="y"},47113:function(t,e,i){"use strict";i.d(e,{$3:function(){return I},$r:function(){return M},A1:function(){return ts},D8:function(){return g},Ep:function(){return T},Gs:function(){return x},H$:function(){return w},H3:function(){return tr},Ht:function(){return W},Or:function(){return k},Oz:function(){return v},P7:function(){return j},Pb:function(){return B},Sr:function(){return ti},Tq:function(){return tn},VV:function(){return O},VZ:function(){return E},XS:function(){return $},Z7:function(){return m},cO:function(){return b},fh:function(){return Y},gK:function(){return P},gw:function(){return C},ie:function(){return K},lz:function(){return V},ml:function(){return R},mv:function(){return Q},p1:function(){return z},sQ:function(){return te},ty:function(){return S},v2:function(){return y},w0:function(){return H},wh:function(){return Z},yr:function(){return J},yu:function(){return _},zY:function(){return L}});var s=i(23814),r=i(52660),n=i(52734),o=i(81052),a=i(29653),l=i(7344),c=i(90690),h=i(51967),d=i(95035),f=i(14127),u=i(53587);let g=["fixedHeight","fixedWidth","overrides","uploadId","fontId","height","width","id","isMask","isEditingMask","startLineType","endLineType","hasControls","lockMovementX","lockMovementY","lockScalingX","lockScalingY","lockSkewingX","lockSkewingY","lockRotation","maxOverrideTextLines","internal","textCase","areaLeft","areaTop","areaWidth","areaHeight","verticalTextAlign","overrides"],p=t=>t.toObject(g),m=["frame","grid","lm-start","lm-end"],v=t=>m.includes(null==t?void 0:t.id),y=t=>{var e;let{target:i}=t,s=w(i)?i.textbox:i,{fixedWidth:r,fontSize:n,width:o}=s;s.calcTextWidth();let a=o,l=1;s.maxOverrideTextLines&&s.maxOverrideTextLines>0&&(l=s.maxOverrideTextLines);let c=s.textLines.length-l;if((null===(e=s.overrides)||void 0===e?void 0:e.text)&&s.overridesApplied&&c>0&&(a=s.__lineWidths.reduce((t,e)=>t+e,0)+n*s.__lineWidths.length*.3),a>r){let t=s.left+s.width/2,e=s.top+s.height/2;w(i)&&(t=i.width/2,e=i.height/2),s.fontSize=Math.round(n*r/(a+1)),"center"===s.textAlign?s.left=t-s.width/2:"right"===s.textAlign?s.left=t-s.width:s.left=t-s.width/2,s.top=e-s.height/2}s.width=r,(w(i)||x(i)&&i.type===d.X)&&i.overridesApplied&&i.recalcTextPosition&&i.splitTextIntoMaxOverrideLines&&(i.splitTextIntoMaxOverrideLines(),i.recalcTextPosition()),s.dirty=!0,i.dirty=!0},b=t=>t._objects?t._objects.every(t=>b(t)):!!t.lockMovementX||!!t.lockMovementY||!!t.lockRotation||!!t.lockScalingX||!!t.lockScalingY||!!t.lockSkewingX||!!t.lockSkewingY||!!t.lockRotation,_=(t,e)=>{if(e(t),t._objects)for(let i of t._objects)_(i,e)},x=t=>!!t&&["i-text","textbox","text",d.X].includes(null==t?void 0:t.type),w=t=>!!t&&(null==t?void 0:t.type)===h.RD,k=t=>(null==t?void 0:t.type)==="image",T=t=>(null==t?void 0:t.type)==="rect",C=t=>(null==t?void 0:t.type)==="circle",S=t=>(null==t?void 0:t.type)==="group",O=t=>{let e=a.dN.indexOf((null==t?void 0:t.type)||"")>=0,i=(null==t?void 0:t.type)==="rect"&&(null==t?void 0:t.linkedElement);return e&&!i},j=t=>(null==t?void 0:t.type)==="advancedLine",L=t=>t instanceof l.fabric.ActiveSelection,A=t=>{if(!S(t))return[];let e=new Set;return _(t,t=>{S(t)||e.add(t.type)}),Array.from(e)},P=t=>{let e=A(t);return a.dN.some(t=>e.includes(t))},M=t=>A(t).every(t=>a.dN.includes(t)),z=(t,e,i)=>{let s=t.getObjects(),r=0,n=0;s.forEach(t=>{let e=t.left+t.width*t.scaleX,i=t.top+t.height*t.scaleY;r=Math.max(r,e),n=Math.max(n,i)});let o="transparent";e&&(o=e.fill,r=e.width,n=e.height);let a=p(t);return{...a,overrides:i,objects:structuredClone(I(a.objects)),backgroundImage:void 0,background:o,height:n,width:r}},I=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.filter(t=>{let{id:e,internal:i}=t;return!m.includes(e)&&!i})},E=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;if(!e.height)return 1;let s=1,r=e.height*e.scaleY,n=e.width*e.scaleX;s=Math.min(t.height/r,t.width/n)*i;let o=e.top+e.height/2,a=-(e.left+e.width/2)*s+t.width/2,l=-o*s+t.height/2;return t.setViewportTransform([s,0,0,s,a,l]),s},K=function(t,e,i,s){return Math.min(t/i,e/s)},W=t=>Math.PI/180*t,X={month_num:t=>new Intl.DateTimeFormat(void 0,{month:"2-digit"}).format(t),month_short:t=>new Intl.DateTimeFormat(void 0,{month:"short"}).format(t),month_long:t=>new Intl.DateTimeFormat(void 0,{month:"long"}).format(t),century_short:t=>new Intl.DateTimeFormat(void 0,{year:"numeric"}).format(t).slice(0,-2),year_short:t=>new Intl.DateTimeFormat(void 0,{year:"2-digit"}).format(t),year_long:t=>new Intl.DateTimeFormat(void 0,{year:"numeric"}).format(t)},D=async(t,e)=>{let i=t=>void 0!==t.type,s=t.overrides;if(!s)return t;let r=structuredClone(t);for(let[t,n]of Object.entries(s).sort((t,e)=>"icon"===e[0]?-1:0)){if(!n)continue;let s=n.split("."),o=e,a=!1,h="";for(let t of s)a&&(h=t),"date"===t&&(a=!0),o&&"object"==typeof o&&(o=o[t]);if(a&&!o&&(o=new Date().valueOf()),o){if("icon"===t){let t=new l.fabric.Object(r),e=await (0,c.ng)({svg:o,referenceSvg:t});if(!e)continue;r=e.toObject()}else if(a&&(o=(0,X[h])(o)),i(r)&&w(r)){let e=r.objects.find(t=>"textbox"===t.type);e&&(e[t]=o)}else r[t]=o;r.overridesApplied=!0}let d=i(r)?w(r)?r.objects.find(t=>"textbox"===t.type):r:void 0;if("text"===t&&d&&i(d)&&x(d)&&d.textCase){let t=ts(d);d.text=t}i(r)&&G(r,t,n)&&k(r)&&U(r)}return r},Y=async(t,e)=>{let i=structuredClone(t),s=(i=await D(i,e)).objects.map(async t=>{let i=structuredClone(t);if("group"===(i=await D(i,e)).type&&i.objects){let t=i.objects.map(t=>D(t,e));i.objects=await Promise.all(t)}return i});return i.objects=await Promise.all(s),i},R=async(t,e)=>{let i=structuredClone(t),s=i.pages.map(t=>Y(t,e));return i.pages=await Promise.all(s),i},H=t=>{let e=t.width,i=t.height;if(void 0===e||void 0===i)return;let s=I(t.getObjects());s.forEach(t=>{if(x(t)||w(t)){let e=w(t)?t.textbox:t,i=t.getCenterPoint(),s=t.aCoords,r=1.05*Math.max(...e.__lineWidths);if(!s)return;let n=s.tl.y,o=s.tl.x,a="top",c="left";if(w(t)){let e=t.verticalTextAlign||"top";switch(t.flipY&&(e="top"===e?"bottom":"top"),e){case"top":n=s.tl.y,a="top";break;case"center":n=i.y,a="center";break;case"bottom":n=s.bl.y,a="bottom"}}let h=e.textAlign||"left";switch(t.flipX&&(h="left"===h?"right":"left"),h){case"right":o=s.tr.x,c="right";break;case"center":o=i.x,c="center";break;case"left":o=s.tl.x,c="left"}let d=new l.fabric.Point(o,n);w(t)?(t.resetAreaToText(),t.setPositionByOrigin(d,c,a)):(e.set({width:r,fixedWidth:r}),t.setPositionByOrigin(d,c,a),t.setCoords())}});let r=new l.fabric.ActiveSelection(s),n=r.width,o=r.height;r.scale(Math.min(.7*e/n,.7*i/o)),r.destroy(),F(s),(r=new l.fabric.ActiveSelection(s)).setPositionByOrigin(new l.fabric.Point(e/2,i/2),"center","center"),r.destroy()},F=t=>{t.forEach(t=>{w(t)&&t.recalcTextPosition()})},U=t=>{let e=t.width*(t.scaleX||1),i=t.height*(t.scaleY||1);t.width=e,t.height=i,t.scaleX=1,t.scaleY=1,t.src+="&width=".concat(e,"&height=").concat(i)},G=(t,e,i)=>"image"===t.type&&"src"===e&&!!i,B=(t,e,i)=>t/e*i,V=async t=>{let e=new Set,i=[],n="https://app-cdn".concat(s.BB?"":"-dev",".logo.com/assets/fonts"),o=t=>{for(let s of t.objects)x(s)&&void 0===s.fontId&&(f.k.warn("Font id not present for text element ".concat(s.id,". Adding default font.")),s.fontFamily=u.U.family,s.fontId=u.U.id,s.fontStyle=u.U.italic?"italic":"normal",s.fontWeight=u.U.weight),s.fontId&&s.fontWeight&&s.fontStyle&&s.fontFamily&&(e.add(s.fontId),i.push({weight:s.fontWeight,style:s.fontStyle,family:s.fontFamily,url:"".concat(n,"/").concat(s.fontId,".ttf")})),s.objects&&o(s)};o(t);let a=[];for(let t of i){let e=(0,r.Mv)({weight:t.weight,italic:"italic"===t.style,url:t.url,family:t.family});a.push(e)}return Promise.all(a)},q=t=>t.strokeWidth/(t.strokeUniform?t.scaleX:1),N=t=>{let{transform:e,x:i,y:s}=t;return l.fabric.controlsUtils.getLocalPoint(e,e.originX,e.originY,i,s)},$=t=>{let e=t.type,i={};i=b(t)?{bl:!1,br:!1,mb:!1,ml:!1,mr:!1,mt:!1,tl:!1,tr:!1,mtr:!1}:{bl:!0,br:!0,mb:!0,ml:!0,mr:!0,mt:!0,tl:!0,tr:!0,mtr:!0},"image"===e&&(i={mt:!1,mb:!1,ml:!1,mr:!1}),t.setControlsVisibility(i)},Z=(t,e,i,s)=>{let r=e.target,n=l.fabric.controlsUtils.getLocalPoint(e,e.originX,e.originY,i,s),o=(r.strokeWidth||1)/(r.strokeUniform?r.scaleX:1),a=0;if(x(r)&&r.text){let t=r._textLines;for(let e=0;e<t.length;e++)t[e].includes(" ")||(a=Math.max(a,r.measureLine(e).width))}let c=Math.max(Math.max(Math.abs(n.x/r.scaleX)-o,0),a);return r.set({width:c,fixedWidth:c}),!0},J=(t,e,i,s)=>{let r=e.target,n=N({transform:e,x:i,y:s}),o=q(r),a=Math.max(Math.abs(n.x/r.scaleX)-o,1);return Q(r,a),!0},Q=(t,e)=>{let i=t.strokeWidth,s=t.fontSize,r=t.width,n=e/r*s,o=Math.floor(n),a=(n-o)/o;n=Math.floor(n),e=e>r?Math.ceil(e-e*a):Math.floor(e-e*a);let l=B(i||0,s,n);e=Math.max(e,1),n=Math.max(n,1),t.set({width:e,fixedWidth:e,fontSize:n,scaleX:1,scaleY:1,strokeWidth:l})},tt=(t,e)=>function(){for(var t=arguments.length,i=Array(t),s=0;s<t;s++)i[s]=arguments[s];return e(...i)},te=(t,e)=>{let i={};return Object.entries(e).forEach(e=>{let[s,r]=e,n=tt(s,r);t.on(s,n),i[s]=n}),()=>{Object.entries(i).forEach(e=>{let[i,s]=e;t.off(i,s)})}},ti=t=>{let e=new Map,i=t=>{if(t.fontId&&e.set(t.fontId,{id:t.fontId,fontFamily:t.fontFamily,fontWeight:t.fontWeight,fontStyle:t.fontStyle}),t.objects)for(let e of t.objects)i(e)};for(let e of t)for(let t of e.objects)i(t);return Array.from(e.values())},ts=t=>{if(!x(t))return;let e=t.text||"";switch(t.textCase){case"lowercase":e=e.toLocaleLowerCase();break;case"uppercase":e=e.toLocaleUpperCase();break;case"titlecase":e=(0,n.LF)(e)}return e},tr=t=>"string"!=typeof t&&!!(t.colorStops&&t.colorStops.length>0),tn=t=>{for(let i of I(t.getObjects()).filter(t=>w(t))){var e;let{top:s,left:r,angle:n,flipX:a,flipY:c,overrides:h,maxOverrideTextLines:d,overridesApplied:f}=i,u=p(i.textbox),{overridesApplied:g}=i.textbox,m=new l.fabric.Textbox(null!==(e=i.textbox.text)&&void 0!==e?e:"",{...u,id:(0,o.V)("textbox"),top:s,left:r,angle:n,flipX:a,flipY:c});m.overridesApplied=g||f,m.fixedWidth=u.width,m.overrides=structuredClone(h),m._originalSplitTextIntoLines&&(m._splitTextIntoLines=m._originalSplitTextIntoLines),m.maxOverrideTextLines=d;let v=t.getObjects().findIndex(t=>t.id===i.id);t.remove(i),t.add(m),t.moveTo(m,v)}t.renderAll()}},23137:function(t,e,i){"use strict";i.d(e,{$W:function(){return o},$p:function(){return r},$z:function(){return m},Ff:function(){return s},Qg:function(){return g},Zy:function(){return h},eT:function(){return n},g8:function(){return v},i1:function(){return p},tH:function(){return a},vq:function(){return c},wo:function(){return f}});let s=t=>/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/.test(t),r=t=>{if(!t)return"light";if("#000000"===t)return"dark";let{r:e,g:i,b:s}=o(t);return(299*e+587*i+114*s)/1e3>=128?"light":"dark"},n=t=>{if(!/^#?([a-fA-F0-9]{3})$/.test(t))return t;let e=t.match(/^#?([\da-f])([\da-f])([\da-f])$/i)||[];return"#".concat(e[1]).concat(e[1]).concat(e[2]).concat(e[2]).concat(e[3]).concat(e[3])},o=t=>{if("transparent"===t)return{r:0,g:0,b:0,value:"0 0 0"};let e=(t=n(t)).match(/^#?([\da-f]{2})([\da-f]{2})([\da-f]{2})$/i)||[],i={r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)};return{...i,value:d(i)}},a=t=>{let{r:e,g:i,b:s}=t,[r,n,o,a]=[0,0,0,0];e/=255,i/=255,s/=255,a=Math.min(1-e,1-i,1-s);let l={c:Math.round(100*((1-e-a)/(1-a)||0)),m:Math.round(100*((1-i-a)/(1-a)||0)),y:Math.round(100*((1-s-a)/(1-a)||0)),k:Math.round(100*a)};return{...l,value:d(l)}};function l(t){var e=t.toString(16);return 1==e.length?"0"+e:e}function c(t,e,i){return"#"+l(t)+l(e)+l(i)}function h(){return[Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random())]}let d=t=>Object.values(t).join(" "),f=(t,e)=>{let{r:i,g:s,b:r}=o(t),{r:n,g:a,b:l}=o(e),c=u(i,s,r),h=u(n,a,l);return 1/(c>h?(h+.05)/(c+.05):(c+.05)/(h+.05))},u=(t,e,i)=>{let s=[t,e,i].map(t=>(t/=255)<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4));return .2126*s[0]+.7152*s[1]+.0722*s[2]},g=(t,e,i)=>{let{r:s,g:n,b:a}=o(i||t),l=[s,n,a],h=[];return c((h="light"===r(t)?l.map(t=>Math.round(t-(t-0)*e)):l.map(t=>Math.round(t+(255-t)*e)))[0],h[1],h[2])},p=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e&&"transparent"===t?t:s(t)?t.startsWith("#")?t:"#".concat(t):""},m=t=>{let e=t.slice(4,-1).split(",").map(t=>t.trim()),i=parseInt(e[0],10),s=parseInt(e[1],10),r=parseInt(e[2],10);if(!isNaN(i)&&!isNaN(s)&&!isNaN(r)&&i>=0&&i<=255&&s>=0&&s<=255&&r>=0&&r<=255)return c(i,s,r)},v=t=>t.startsWith("rgb(")&&t.endsWith(")")},47665:function(t,e,i){"use strict";i.d(e,{D:function(){return r}});var s=void 0;let r=function(t){let e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;return function(){for(var r=arguments.length,n=Array(r),o=0;o<r;o++)n[o]=arguments[o];clearTimeout(e),e=setTimeout(()=>{t.apply(s,n)},i)}}},23814:function(t,e,i){"use strict";i.d(e,{BB:function(){return s},D0:function(){return n},r8:function(){return r}});let s=!0,r=!1,n=!1},52734:function(t,e,i){"use strict";i.d(e,{LF:function(){return s},Pv:function(){return l},do:function(){return r},kq:function(){return o},lc:function(){return a},yk:function(){return n}});let s=t=>t.replace(/\w\S*/g,t=>t.charAt(0).toLocaleUpperCase()+t.substring(1).toLocaleLowerCase()),r=t=>t.replace(/_/g," ").replace(/\w\S*/g,t=>t.charAt(0).toUpperCase()+t.substring(1).toLowerCase()),n=t=>t.replace(/-/g," ").replace(/\w\S*/g,t=>t.charAt(0).toUpperCase()+t.substring(1).toLowerCase()),o=t=>t.replace(/_/g," ").replace(/\w\S*/g,t=>t.charAt(0).toLowerCase()+t.substring(1).toLowerCase()),a=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return t.replace(/_/g," ").split(" ").map(t=>t?t[0].toUpperCase()+t.substring(1).toLowerCase():"").join(e)},l=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return t.split(" ").filter(Boolean).map(t=>t[0].toUpperCase()).join("").slice(0,e)}}}]);